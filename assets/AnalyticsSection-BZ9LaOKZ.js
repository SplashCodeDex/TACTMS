import{c as M,j as e,r as g,G as D,f as _,m as E,B as k,u as R,b as T,d as L,U as q,e as I}from"./index-CuI5jObH.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=M("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=M("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=M("MessageSquareQuote",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M8 12a2 2 0 0 0 2-2V8H8",key:"1jfesj"}],["path",{d:"M14 12a2 2 0 0 0 2-2V8h-2",key:"1dq9mh"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=M("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=M("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),B=()=>e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--bg-elevated)] animate-pulse flex-shrink-0"}),e.jsx("div",{className:"w-3/5",children:e.jsx("div",{className:"h-20 w-full rounded-lg bg-[var(--bg-elevated)] animate-pulse"})})]}),e.jsxs("div",{className:"flex items-end gap-3 flex-row-reverse",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--bg-elevated)] animate-pulse flex-shrink-0"}),e.jsx("div",{className:"w-1/2",children:e.jsx("div",{className:"h-12 w-full rounded-lg bg-[var(--bg-elevated)] animate-pulse"})})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--bg-elevated)] animate-pulse flex-shrink-0"}),e.jsx("div",{className:"w-4/5",children:e.jsx("div",{className:"h-28 w-full rounded-lg bg-[var(--bg-elevated)] animate-pulse"})})]})]}),K="AIzaSyCc8wwsp9E7PuNUu20Svoc_wSaSQXtMbjM",V=()=>{const[n,a]=g.useState([]),[l,y]=g.useState([]),[c,m]=g.useState(!1),[i,o]=g.useState(null),r=g.useRef(null),v=g.useCallback(async(t,u,j,p,d,b)=>{if(!t||t.length===0){o("No data available to analyze.");return}m(!0),o(null),a([]),y([]),r.current=null;try{const h=new D({apiKey:K}).chats.create({model:"gemini-2.5-flash",config:{systemInstruction:`You are an expert financial analyst for a church, acting as a helpful AI assistant named 'Dex'. You are in a chat with a user about their tithe data${u?` for the ${u} Assembly`:""}.
          - Your tone should be encouraging, insightful, and professional.
          - Keep your responses concise and easy to read. Use markdown for formatting (bolding, lists).
          - When asked for analysis, ground your answers in the data provided.
          - For your very first message, you MUST provide a JSON object containing 'summary' and 'chartData'.
          - The 'summary' must be a concise, bulleted markdown string of the most important, actionable insights from the data provided. It should be 2-4 bullet points.
          - The 'chartData' should be an array of objects for contribution brackets, excluding the 'GHS 0' bracket. Each object needs a 'label' (string) and 'count' (number).
          - Structure your first response like this:
            \`\`\`json
            {
              "summary": "- **Participation:** 75% of members contributed this period.\\n- **Key Bracket:** The GHS 51-200 bracket had the most contributors.",
              "chartData": [ ... ]
            }
            \`\`\`
          - For all subsequent messages, respond conversationally as a helpful assistant without using the JSON format. Start your first conversational response with 'Hello! I've analyzed the data...'.`}});r.current=h;const f=t.length,A=f>0?(p/f*100).toFixed(1):"0.0",$=p>0?(b/p).toFixed(2):"0.00",S={"GHS 0":d,"GHS 1-50":0,"GHS 51-200":0,"GHS 201-500":0,"GHS 501-1000":0,"GHS 1000+":0};t.forEach(N=>{const w=Number(N["Transaction Amount"])||0;w>0&&(w<=50?S["GHS 1-50"]++:w<=200?S["GHS 51-200"]++:w<=500?S["GHS 201-500"]++:w<=1e3?S["GHS 501-1000"]++:S["GHS 1000+"]++)});const O=JSON.stringify(S),P=`
        Here is the data summary for my analysis. Please provide the initial report in the required JSON format.
        - Assembly: ${u||"Unknown"}
        - Transaction Date for List: ${_(j)}
        - Total Records: ${f}
        - Tithers (gave > 0): ${p} (${A}%)
        - Non-Tithers (gave 0): ${d}
        - Total Amount Collected: GHS ${b.toFixed(2)}
        - Average Contribution per Tither: GHS ${$}
        - Contribution Bracket Counts: ${O}
      `,z=(await h.sendMessage({message:P})).text;let H="I'm having trouble providing an initial analysis. Please try again.";try{let N=(z??"").trim();const w=/^```(\w*)?\s*\n?(.*?)\n?\s*```$/s,G=N.match(w);G&&G[2]&&(N=G[2].trim());const C=JSON.parse(N);C.chartData&&y(C.chartData),C.summary&&(H=C.summary),a([{role:"model",parts:[{text:`Hello! I've analyzed the data for **${u||"your assembly"}**. Ask me anything about it!`}],summary:H}])}catch(N){console.error("Failed to parse initial JSON response:",N),o("AI response was not in the expected format. Displaying raw response."),a([{role:"model",parts:[{text:z??""}]}])}}catch(x){console.error("Gemini API Error:",x),o("Failed to start chat with AI. The service may be unavailable. Please try again later."),a([])}finally{m(!1)}},[]),s=g.useCallback(async t=>{const u=r.current;if(!u){o("Chat is not initialized. Please start an analysis first.");return}m(!0);const j={role:"user",parts:[{text:t}]},p={role:"model",parts:[{text:""}],isLoading:!0};a(d=>[...d,j,p]);try{const d=await u.sendMessageStream({message:t});let b="";for await(const x of d)b+=x.text,a(h=>{const f=[...h];return f[f.length-1]={role:"model",parts:[{text:b}],isLoading:!0},f});a(x=>{const h=[...x];return h[h.length-1]={role:"model",parts:[{text:b}]},h})}catch(d){console.error("Gemini Send Message Error:",d);const b="Sorry, I encountered an error. Please try again.";a(x=>{const h=[...x];return h[h.length-1]={role:"model",parts:[{text:b}]},h})}finally{m(!1)}},[]);return{chatHistory:n,chartData:l,isLoading:c,error:i,startChat:v,sendMessage:s}},Q=E.rect,X=E.text,Z=({data:n})=>{if(!n||n.length===0)return e.jsx("p",{className:"text-center text-[var(--text-muted)] text-sm",children:"No chart data available."});const a=220,l=35,y=20,c=n.length*(l+y),m=Math.max(...n.map(i=>i.count),0);return e.jsx("div",{className:"bar-chart-container w-full overflow-x-auto pb-4",children:e.jsxs("svg",{width:c,height:a,"aria-label":"Contribution Distribution Chart",children:[e.jsx("g",{transform:"translate(0, 10)",children:n.map((i,o)=>{const r=m>0?i.count/m*(a-40):0;return e.jsxs("g",{transform:`translate(${o*(l+y)}, 0)`,children:[e.jsx("title",{children:`${i.label}: ${i.count} members`}),e.jsx(Q,{className:"bar",x:0,y:a-30-r,width:l,height:r,fill:"url(#barGradient)",rx:"4",ry:"4",initial:{height:0,y:a-30},animate:{height:r,y:a-30-r},transition:{duration:.8,ease:[.22,1,.36,1],delay:o*.1}}),e.jsx(X,{className:"bar-value",x:l/2,y:a-35-r,textAnchor:"middle",initial:{opacity:0,y:a-30},animate:{opacity:1,y:a-35-r},transition:{duration:.8,ease:"easeOut",delay:o*.1+.3},children:i.count}),e.jsx("text",{className:"axis-text",x:l/2,y:a-15,textAnchor:"middle",children:i.label})]},i.label)})}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--primary-accent-hover-start)"}),e.jsx("stop",{offset:"100%",stopColor:"var(--primary-accent-start)"})]})})]})})},ee=({chatHistory:n,isLoading:a,onSendMessage:l,suggestedPrompts:y})=>{const[c,m]=g.useState(""),i=g.useRef(null);g.useEffect(()=>{var s;(s=i.current)==null||s.scrollIntoView({behavior:"smooth"})},[n]);const o=s=>{s==null||s.preventDefault(),c.trim()&&!a&&(l(c.trim()),m(""))},r=s=>{l(s)},v=s=>{let t=s;return t=t.replace(/^### (.*$)/gm,'<h3 class="text-lg font-semibold text-[var(--text-primary)] mt-3 mb-1">$1</h3>'),t=t.replace(/^## (.*$)/gm,'<h2 class="text-xl font-bold text-gradient-primary mt-4 mb-2">$1</h2>'),t=t.replace(/^# (.*$)/gm,'<h1 class="text-2xl font-bold text-gradient-primary mt-5 mb-3">$1</h1>'),t=t.replace(/((?:^[*-] .*(?:\n|$))+)/gm,u=>`<ul class="list-outside mt-2">${u.trim().split(`
`).map(p=>`<li class="list-disc ml-5 mb-1.5">${p.replace(/^[*-] /,"").trim()}</li>`).join("")}</ul>`),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/__(.*?)__/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t=t.replace(/_(.*?)_/g,"<em>$1</em>"),t=t.replace(/\n/g,"<br />"),t=t.replace(/<br \/>\s*(<(?:ul|ol|h[1-3]))/g,"$1"),t=t.replace(/(<\/(?:ul|ol|h[1-3])>)\s*<br \/>/g,"$1"),t};return e.jsxs("div",{className:"flex flex-col h-[60vh] md:h-[calc(100vh-250px)]",children:[e.jsxs("div",{className:"flex-grow overflow-y-auto pr-4 space-y-6",children:[n.map((s,t)=>e.jsx("div",{className:`chat-message ${s.role}`,children:e.jsx("div",{className:`chat-bubble ${s.role}`,children:s.isLoading&&s.parts[0].text===""?e.jsxs("div",{className:"typing-indicator px-2 py-1",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}):e.jsx("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:v(s.parts[0].text||"")}})})},t)),e.jsx("div",{ref:i})]}),e.jsxs("div",{className:"pt-4 mt-auto",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:y.map(s=>e.jsxs(k,{size:"sm",variant:"subtle",onClick:()=>r(s),disabled:a,children:[e.jsx(W,{size:14,className:"mr-1.5 text-[var(--primary-accent-end)]"})," ",s]},s))}),e.jsxs("form",{onSubmit:o,className:"flex items-center gap-3",children:[e.jsx("textarea",{value:c,onChange:s=>m(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&o(s)},placeholder:"Ask a follow-up question...",className:"form-input-light flex-grow !rounded-xl resize-none",rows:1,style:{maxHeight:"150px"},disabled:a}),e.jsx(k,{type:"submit",size:"icon",variant:"primary",disabled:a||!c.trim(),children:e.jsx(U,{size:18})})]})]})]})},te=({summary:n})=>{const a=n.replace(/\n/g,"<br />").replace(/\* \*\*(.*?)\*\*/g,'<li><strong class="text-[var(--primary-accent-start)]">$1</strong>').replace(/<\/strong>:(.*?)<br \/>/g,"</strong>:$1</li>").replace(/- \*\*(.*?)\*\*/g,'<li><strong class="text-[var(--primary-accent-start)]">$1</strong>').replace(/\*\*(.*?)\*\*/g,'<strong class="text-[var(--primary-accent-start)]">$1</strong>').replace(/- (.*?)(<br \/>|$)/g,'<li class="list-none ml-0 mb-1.5">$1</li>');return e.jsxs("div",{className:"content-card bg-[var(--bg-elevated)] border-l-4 border-[var(--primary-accent-start)]",children:[e.jsxs("h3",{className:"section-heading text-base !mb-3",children:[e.jsx(Y,{size:18,className:"mr-3 icon-primary"}),"AI-Generated Summary"]}),e.jsx("ul",{className:"text-sm space-y-2 text-[var(--text-secondary)]",dangerouslySetInnerHTML:{__html:a}})]})},ae=()=>e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((n,a)=>e.jsxs("div",{className:"p-4 bg-[var(--bg-card-subtle-accent)] rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-[var(--border-color)] rounded w-1/3 mb-3"}),e.jsx("div",{className:"h-3 bg-[var(--border-color)] rounded w-full mb-1"}),e.jsx("div",{className:"h-3 bg-[var(--border-color)] rounded w-5/6"})]},a))}),se=({reconciliationReport:n,addToast:a})=>{const[l,y]=g.useState([]),[c,m]=g.useState(!1),[i,o]=g.useState(null),r=(n==null?void 0:n.newMembers)||[],v=async()=>{if(r.length===0){a("No new members found in the current data to generate messages for.","warning");return}m(!0),o(null),y([]);try{const t=new D({apiKey:"AIzaSyCc8wwsp9E7PuNUu20Svoc_wSaSQXtMbjM"}),j=`You are a friendly and welcoming church administrator for The Apostolic Church. Your task is to generate a short, personalized, and encouraging SMS message for each of the following new church members.

Guidelines:
- Keep each message under 160 characters to fit in a standard SMS.
- Start with a warm greeting addressing the member by their first name.
- Express joy that they have joined the church family.
- End with a warm closing, for example "God bless you." or "Welcome to the family!".
- Maintain a positive and uplifting tone.
- DO NOT add any extra text or explanation outside of the required JSON output.

Here are the new members to welcome: ${r.map(d=>`${d["First Name"]||""} ${d.Surname||""}`.trim()).filter(Boolean).join(", ")}
`,p=await t.models.generateContent({model:"gemini-2.5-flash",contents:j,config:{responseMimeType:"application/json",responseSchema:{type:I.ARRAY,items:{type:I.OBJECT,properties:{memberName:{type:I.STRING,description:"The full name of the new church member."},message:{type:I.STRING,description:"The personalized welcome SMS message for the member."}},required:["memberName","message"]}}}});if(p.text){const d=JSON.parse(p.text);if(Array.isArray(d))y(d);else throw new Error("AI response was not a JSON array.")}else throw new Error("AI response was empty.")}catch(t){console.error("Error generating outreach messages:",t),o("Sorry, I couldn't generate the messages. The AI might be busy. Please try again in a moment."),a("Failed to generate outreach messages.","error")}finally{m(!1)}},s=t=>{navigator.clipboard.writeText(t).then(()=>{a("Message copied to clipboard!","success")}).catch(()=>{a("Failed to copy message.","error")})};return e.jsxs("section",{className:"content-card",children:[e.jsxs("h2",{className:"section-heading",children:[e.jsx(J,{size:22,className:"mr-3 icon-primary"}),"AI Outreach Assistant"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"outreach-target",className:"form-label",children:"Select Target Group"}),e.jsx("select",{id:"outreach-target",className:"form-input-light w-full",children:e.jsxs("option",{children:["New Members (Souls Won) (",r.length,")"]})})]}),e.jsx("div",{className:"self-end",children:e.jsx(k,{onClick:v,isLoading:c,disabled:r.length===0||c,variant:"secondary",fullWidth:!0,children:"Generate Welcome Messages"})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-[var(--border-color)]",children:[c&&e.jsx(ae,{}),i&&e.jsxs("div",{className:"text-center py-6 text-[var(--danger-text)]",children:[e.jsx(L,{size:32,className:"mx-auto mb-2"}),e.jsx("p",{children:i})]}),!c&&!i&&l.length>0&&e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:l.map((t,u)=>e.jsxs("div",{className:"p-4 bg-[var(--bg-elevated)] rounded-lg border border-[var(--border-color)]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"font-semibold text-[var(--text-primary)] flex items-center gap-2",children:[e.jsx(q,{size:16})," ",t.memberName]}),e.jsx(k,{size:"sm",variant:"ghost",leftIcon:e.jsx(F,{size:14}),onClick:()=>s(t.message),children:"Copy"})]}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] whitespace-pre-wrap",children:t.message})]},u))}),!c&&!i&&l.length===0&&e.jsx("div",{className:"text-center py-6 text-[var(--text-muted)]",children:r.length>0?"Click 'Generate' to create personalized welcome messages for your new members.":"No new members found in the current workspace. Upload and reconcile a new file to identify them."})]})]})},ie=()=>{var A;const{titheListData:n=[],currentAssembly:a,selectedDate:l,addToast:y,tithersCount:c,nonTithersCount:m,totalAmount:i,reconciliationReport:o}=R(),{chatHistory:r,chartData:v,isLoading:s,error:t,startChat:u,sendMessage:j}=V(),p=()=>{u(n,a,l,c,m,i)},d=$=>{$.trim()&&j($)},b=n.length>0,x=r.length>0,h=(A=r[0])==null?void 0:A.summary,f=["What are the key observations from this data?","Suggest some potential actions based on these numbers.","What if participation increased by 10%?",`How does ${a||"this assembly"} compare to typical patterns?`];return e.jsxs("div",{className:"space-y-8",children:[e.jsx(se,{reconciliationReport:o,addToast:y}),e.jsx("section",{className:"content-card",children:e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsxs("h2",{id:"analytics-heading",className:"section-heading border-none pb-0 mb-0",children:[e.jsx(T,{size:22,className:"mr-3 icon-primary"}),"AI-Powered Analytics Chat"]}),e.jsx(k,{onClick:p,disabled:!b||s,isLoading:s&&!x,variant:"primary",children:x?`Restart Analysis for ${a}`:"Analyze with AI"})]})}),e.jsxs("div",{className:"min-h-[400px]",children:[t&&e.jsxs("div",{className:"content-card text-center py-10 flex flex-col items-center",children:[e.jsx(L,{size:48,className:"text-[var(--danger-text)] mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-[var(--danger-text)]",children:"Analysis Failed"}),e.jsx("p",{className:"text-[var(--text-secondary)] mt-2 max-w-md",children:t})]}),!x&&!s&&!t&&e.jsxs("div",{className:"content-card text-center py-10 flex flex-col items-center animate-fadeIn",children:[e.jsx(T,{size:52,className:"mx-auto text-[var(--text-muted)] mb-4 opacity-50"}),e.jsx("h3",{className:"text-xl font-semibold text-[var(--text-primary)]",children:"Ready for Insights?"}),e.jsx("p",{className:"text-[var(--text-secondary)] mt-2 max-w-md",children:b?`You have a list for ${a} Assembly ready. Click "Analyze with AI" to start a conversation about your data.`:"Generate or load a tithe list in the Processor view, then come back here to get an AI-powered analysis."})]}),s&&!x&&e.jsx("div",{className:"content-card",children:e.jsx(B,{})}),x&&!t&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[h&&e.jsx(te,{summary:h}),e.jsx("div",{className:"content-card",children:e.jsx(ee,{chatHistory:r,isLoading:s,onSendMessage:d,suggestedPrompts:f})})]}),e.jsx("div",{className:"lg:col-span-1 space-y-8 sticky top-8",children:v.length>0&&e.jsxs("div",{className:"content-card animate-fadeIn",children:[e.jsx("h3",{className:"section-heading text-base !mb-6",children:"Contribution Distribution"}),e.jsx(Z,{data:v})]})})]})]})]})};export{ie as default};
