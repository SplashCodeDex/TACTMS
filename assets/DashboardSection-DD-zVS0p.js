import{c as J,j as e,U,S as X,f as G,a as pe,u as ee,r as p,D as ve,m as N,b as R,d as $,e as E,g as F,h as H,B as P,M as be,G as je,T as fe,i as ye,R as Ne,k as we,l as Me}from"./index-D2A2AOn4.js";import{B as ke,S as z,C as Se}from"./ChatInterface-f4xjknmB.js";import{A as te,T as Z}from"./trending-down-DynKzB_r.js";import{T as W}from"./trending-up-Dr4XT2Sc.js";import{S as V,A as Y,D as De}from"./AnimatedNumber-DOsDinCS.js";import{A as se}from"./arrow-right-BAxwy3no.js";import{L as Ae}from"./layers-CXEWKkRO.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=J("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=J("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=J("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Ce=({members:t})=>e.jsxs("section",{className:"content-card",children:[e.jsxs("h2",{className:"section-heading",children:[e.jsx(U,{size:22,className:"mr-3 icon-primary"}),"Recently Added Members"]}),t.length>0?e.jsx(X,{className:"h-[200px]",children:e.jsx("ul",{className:"space-y-3 pr-4",children:t.map((s,a)=>e.jsxs("li",{className:"flex items-center gap-4 p-3 rounded-lg hover:bg-[var(--bg-card-subtle-accent)] transition-colors",children:[e.jsx("div",{className:"w-10 h-10 flex-shrink-0 bg-gradient-to-br from-[var(--accent-purple)] to-[var(--accent-blue)] rounded-lg flex items-center justify-center text-white",children:e.jsx(U,{size:20})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("p",{className:"font-semibold text-sm text-[var(--text-primary)] truncate",children:[s["First Name"]," ",s.Surname]}),e.jsxs("p",{className:"text-xs text-[var(--text-secondary)]",children:[s.firstSeenSource,e.jsx("span",{className:"text-[var(--text-muted)] mx-1",children:" • "}),s.firstSeenDate?G(new Date(s.firstSeenDate)):"N/A"]})]})]},`member-${s["No."]}-${s["First Name"]}-${s.Surname}-${a}`))})}):e.jsx("p",{className:"text-sm text-center py-8 text-[var(--text-muted)]",children:"No new members recorded recently."})]}),Oe=({activities:t})=>e.jsxs("section",{className:"content-card",children:[e.jsxs("h2",{className:"section-heading",children:[e.jsx(te,{size:22,className:"mr-3 icon-primary"}),"Recent Activity"]}),t.length>0?e.jsx(X,{className:"h-[200px]",children:e.jsx("ul",{className:"space-y-3 pr-4",children:t.map((s,a)=>e.jsxs("li",{className:"flex items-center gap-4 p-3 rounded-lg hover:bg-[var(--bg-card-subtle-accent)] transition-colors",children:[e.jsx("div",{className:"w-10 h-10 flex-shrink-0 bg-gradient-to-br from-[var(--primary-accent-start)] to-[var(--primary-accent-end)] rounded-lg flex items-center justify-center text-white",children:e.jsx(U,{size:20})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("p",{className:"font-semibold text-sm text-[var(--text-primary)] truncate",children:[s.assemblyName," Assembly"]}),e.jsxs("p",{className:"text-xs text-[var(--text-secondary)]",children:[G(new Date(s.selectedDate)),e.jsx("span",{className:"text-[var(--text-muted)] mx-1",children:" • "}),e.jsxs("span",{className:"font-medium text-[var(--success-text)]",children:["GH₵ ",s.totalTitheAmount.toLocaleString()]}),e.jsx("span",{className:"text-[var(--text-muted)] mx-1",children:" • "}),e.jsxs("span",{className:"font-medium text-[var(--text-primary)]",children:[s.titherCount," Tithers"]}),e.jsx("span",{className:"text-[var(--text-muted)] mx-1",children:" • "}),e.jsxs("span",{className:"font-medium text-[var(--accent-purple)]",children:[s.soulsWonCount," Souls Won"]})]})]})]},`activity-${s.id}-${s.timestamp}-${a}`))})}):e.jsx("p",{className:"text-sm text-center py-8 text-[var(--text-muted)]",children:"No recent transactions logged."})]}),ze=({data:t})=>{const s=t.every(a=>a.count===0);return e.jsxs("section",{className:"lg:col-span-3 content-card relative",children:[e.jsxs("h2",{className:"section-heading",children:[e.jsx(W,{size:22,className:"mr-3 icon-primary"}),"Weekly Tithe Trend"]}),e.jsx("p",{className:"text-sm text-center py-4 text-[var(--text-muted)]",children:"Showing data for the last 6 weeks."}),e.jsx(ke,{data:t}),s&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-[var(--text-muted)] bg-[var(--bg-card)]/50 backdrop-blur-sm rounded-xl",children:[e.jsx(W,{size:32,className:"mb-2 opacity-50"}),e.jsx("p",{children:"No tithe data recorded recently"})]})]})},We=({ytdTithe:t,ytdSouls:s,totalMembers:a,currentMonth:r})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(V,{icon:e.jsx(De,{}),label:`Monthly Tithe (${r})`,value:e.jsxs(e.Fragment,{children:["GH₵"," ",e.jsx(Y,{n:t,formatter:c=>c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]})}),e.jsx(V,{icon:e.jsx(W,{}),label:"Monthly Souls Won",value:e.jsx(Y,{n:s})}),e.jsx(V,{icon:e.jsx(pe,{}),label:"Total Members on Record",value:e.jsx(Y,{n:a})})]}),Ie=({selectedAssembly:t,setSelectedAssembly:s,assembliesWithData:a,memberDatabaseEmpty:r,onStartWeek:c,onScanClick:m,onBatchScanClick:l,imageInputRef:u,onImageChange:d})=>{const{assemblies:y}=ee(),n=p.useMemo(()=>{const i=new Set(ve);return y.filter(k=>i.has(k)||a.has(k))},[y,a]);return e.jsxs("section",{className:"lg:col-span-2 content-card flex flex-col h-full gap-6",children:[e.jsxs("h2",{className:"section-heading mb-0 pb-3 border-b border-[var(--border-color)]",children:[e.jsx(B,{size:22,className:"mr-3 icon-primary"}),"Quick Actions"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs(N.div,{whileHover:{y:-5},className:"glassmorphism-card p-6 rounded-2xl border border-[var(--border-color)] shadow-sm hover:shadow-md transition-all group cursor-pointer relative overflow-hidden",onClick:c,children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(B,{size:80,className:"text-blue-500"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mb-4 text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform duration-300",children:e.jsx(B,{size:24})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-[var(--text-primary)]",children:"Start New Weekly List"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-6",children:"Create a fresh tithe list for the current week."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{value:t,onValueChange:s,disabled:r,children:[e.jsx($,{id:"assembly-start-select-dash",className:"w-full",children:e.jsx(E,{placeholder:"-- Select Assembly --"})}),e.jsx(F,{className:"glassmorphism-bg border border-[var(--border-color)] rounded-xl",children:n.map(i=>e.jsxs(H,{value:i,disabled:!a.has(i),children:[i," ",a.has(i)?"":"(No member data)"]},i))})]}),e.jsxs(P,{variant:"primary",className:"w-full group-hover:shadow-lg transition-all",onClick:c,disabled:!t,children:["Create List"," ",e.jsx(se,{size:16,className:"ml-2 group-hover:translate-x-1 transition-transform"})]})]})]})]}),e.jsxs(N.div,{whileHover:{y:-5},className:"relative p-6 rounded-2xl border border-indigo-200 dark:border-indigo-800 shadow-sm hover:shadow-md transition-all group cursor-pointer overflow-hidden",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(168, 85, 247, 0.05) 100%)"},onClick:m,children:[e.jsx("div",{className:"absolute top-4 right-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-sm",children:"NEW AI"}),e.jsx("div",{className:"absolute -bottom-4 -right-4 opacity-5 group-hover:opacity-10 transition-opacity",children:e.jsx(K,{size:100,className:"text-indigo-500"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center mb-4 text-indigo-600 dark:text-indigo-400 group-hover:scale-110 transition-transform duration-300 shadow-sm",children:e.jsx(K,{size:24})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-[var(--text-primary)]",children:"Scan Tithe Book (AI)"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-6",children:"Take a photo of a physical tithe book page to digitize it instantly."}),e.jsxs(P,{className:"w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white border-0 shadow-md group-hover:shadow-lg transition-all",children:["Scan Image ",e.jsx(z,{size:16,className:"ml-2"})]}),e.jsx("input",{type:"file",ref:u,onChange:d,className:"hidden",accept:"image/*"})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mb-6",children:e.jsxs(N.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:l,className:"flex items-center gap-3 p-4 rounded-xl border border-[var(--border-color)] bg-[var(--bg-secondary)] hover:bg-[var(--bg-elevated)] transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-teal-100 dark:bg-teal-900/30 flex items-center justify-center text-teal-600 dark:text-teal-400 group-hover:scale-110 transition-transform",children:e.jsx(Ae,{size:20})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-[var(--text-primary)]",children:"Batch Scan"}),e.jsx("div",{className:"text-xs text-[var(--text-tertiary)]",children:"Multi-page upload"})]})]})})]})},Le=["January","February","March","April","May","June","July","August","September","October","November","December"],Re=["Week 1","Week 2","Week 3","Week 4","Week 5"],$e=({isOpen:t,onClose:s,scanAssembly:a,setScanAssembly:r,scanMonth:c,setScanMonth:m,scanWeek:l,setScanWeek:u,assembliesWithData:d,onConfirm:y})=>{const{assemblies:n}=ee();return e.jsx(be,{isOpen:t,onClose:s,title:"Select Assembly for Scan",size:"sm",footerContent:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(P,{variant:"ghost",onClick:s,children:"Cancel"}),e.jsxs(P,{variant:"primary",onClick:y,disabled:!a,children:["Continue to Scan ",e.jsx(se,{size:16,className:"ml-2"})]})]}),children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("p",{className:"text-[var(--text-secondary)]",children:"Please select the assembly this tithe list belongs to."}),e.jsxs(R,{value:a,onValueChange:r,children:[e.jsx($,{className:"w-full",children:e.jsx(E,{placeholder:"-- Select Assembly --"})}),e.jsx(F,{className:"glassmorphism-bg border border-[var(--border-color)] rounded-xl",children:n.map(i=>e.jsxs(H,{value:i,disabled:!d.has(i),children:[i," ",d.has(i)?"":"(No member data)"]},i))})]}),!d.has(a)&&a&&e.jsx("p",{className:"text-xs text-amber-500 mt-2",children:"Warning: No member data found for this assembly. Reconciliation might fail."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-[var(--text-secondary)]",children:"Target Month"}),e.jsxs(R,{value:c,onValueChange:m,children:[e.jsx($,{children:e.jsx(E,{placeholder:"Month"})}),e.jsx(F,{className:"glassmorphism-bg border border-[var(--border-color)]",children:Le.map(i=>e.jsx(H,{value:i,children:i},i))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-[var(--text-secondary)]",children:"Target Week"}),e.jsxs(R,{value:l,onValueChange:u,children:[e.jsx($,{children:e.jsx(E,{placeholder:"Week"})}),e.jsx(F,{className:"glassmorphism-bg border border-[var(--border-color)]",children:Re.map(i=>e.jsx(H,{value:i,children:i},i))})]})]})]})]})})},Ee=async(t,s,a)=>{const r=[];if(t.length<2)return{predictions:[{id:"insufficient_data",type:"anomaly",title:"More Data Needed",message:"Upload at least 2 weeks of tithe data to see predictions",confidence:1,trend:"stable",actionable:!1}],healthScore:50,keyMetrics:{monthOverMonth:0,weekOverWeek:0,averageTithe:0,activeMemberRate:0}};const c=[...t].sort((u,d)=>new Date(u.selectedDate).getTime()-new Date(d.selectedDate).getTime()),m=Fe(c,s);if(r.push(...He(m)),a&&c.length>=4)try{const u=await Ge(c,a);r.push(...u)}catch(u){console.warn("AI predictions failed, using statistical only:",u)}const l=Pe(m,r);return{predictions:r.slice(0,5),healthScore:l,keyMetrics:m}},Fe=(t,s)=>{const a=new Date,r=a.getMonth(),c=r===0?11:r-1;let m=0,l=0,u=0,d=0,y=0,n=0;const i=new Date(a.getTime()-7*24*60*60*1e3),k=new Date(a.getTime()-14*24*60*60*1e3);t.forEach(j=>{const M=new Date(j.selectedDate);y+=j.totalTitheAmount,n+=j.titherCount,M.getMonth()===r?m+=j.totalTitheAmount:M.getMonth()===c&&(l+=j.totalTitheAmount),M>=i?u+=j.totalTitheAmount:M>=k&&M<i&&(d+=j.totalTitheAmount)});const A=l>0?(m-l)/l*100:0,I=d>0?(u-d)/d*100:0,T=n>0?y/n:0;let C=0;Object.values(s).forEach(j=>{C+=j.data.length});const O=new Set(t.flatMap(j=>j.titheListData.map(M=>M["Membership Number"]))).size,_=C>0?O/C*100:0;return{monthOverMonth:Math.round(A*10)/10,weekOverWeek:Math.round(I*10)/10,averageTithe:Math.round(T),activeMemberRate:Math.round(_*10)/10}},He=t=>{const s=[];return Math.abs(t.monthOverMonth)>=10&&s.push({id:"mom_trend",type:"tithe_trend",title:t.monthOverMonth>0?"Tithe Growth":"Tithe Decline",message:`Tithe is ${Math.abs(t.monthOverMonth)}% ${t.monthOverMonth>0?"higher":"lower"} than last month`,confidence:.85,trend:t.monthOverMonth>0?"up":"down",actionable:t.monthOverMonth<-10,action:t.monthOverMonth<-10?"Consider member outreach this week":void 0}),Math.abs(t.weekOverWeek)>=20&&s.push({id:"wow_volatility",type:"anomaly",title:"Weekly Fluctuation",message:`This week's tithe ${t.weekOverWeek>0?"spiked":"dropped"} by ${Math.abs(t.weekOverWeek)}%`,confidence:.7,trend:t.weekOverWeek>0?"up":"down",actionable:!0,action:"Review attendance data for this period"}),t.activeMemberRate<30&&s.push({id:"low_engagement",type:"member_churn",title:"Low Engagement",message:`Only ${t.activeMemberRate}% of members have tithed recently`,confidence:.9,trend:"down",actionable:!0,action:"Consider sending reminder messages to inactive members"}),new Date().getMonth()===10&&s.push({id:"december_forecast",type:"seasonal",title:"December Forecast",message:"Historically, December tithe is 15-20% higher due to year-end giving",confidence:.75,trend:"up",actionable:!1}),s},Ge=async(t,s)=>{const r=new je(s).getGenerativeModel({model:"gemini-2.0-flash"}),c=t.slice(-8).map(l=>({date:l.selectedDate,amount:l.totalTitheAmount,tithers:l.titherCount,assembly:l.assemblyName})),m=`Analyze this church tithe data and provide 1-2 actionable insights as JSON:
${JSON.stringify(c,null,2)}

Return ONLY valid JSON array with objects having: id, type (tithe_trend|member_churn|souls_forecast), title, message, confidence (0-1), trend (up|down|stable), actionable (boolean), action (optional string)`;try{const d=(await r.generateContent(m)).response.text().match(/\[[\s\S]*\]/);if(d)return JSON.parse(d[0])}catch(l){console.warn("AI prediction parsing failed:",l)}return[]},Pe=(t,s)=>{let a=50;t.monthOverMonth>10?a+=15:t.monthOverMonth>0&&(a+=10),t.activeMemberRate>50?a+=20:t.activeMemberRate>30&&(a+=10),t.monthOverMonth<-15?a-=20:t.monthOverMonth<0&&(a-=10),t.activeMemberRate<20&&(a-=15);const r=s.filter(c=>c.trend==="down"&&c.actionable).length;return a-=r*5,Math.max(0,Math.min(100,a))},_e=({transactionLogs:t,memberDatabase:s,apiKey:a})=>{const[r,c]=p.useState(null),[m,l]=p.useState(!1);p.useEffect(()=>{(async()=>{if(!(t.length<1)){l(!0);try{const i=await Ee(t,s,a);c(i)}catch(i){console.error("Failed to generate predictions:",i)}finally{l(!1)}}})()},[t,s,a]);const u=n=>{switch(n){case"up":return e.jsx(W,{className:"text-green-500",size:16});case"down":return e.jsx(Z,{className:"text-red-500",size:16});default:return e.jsx(Te,{className:"text-gray-500",size:16})}},d=n=>n>=70?"text-green-500":n>=40?"text-yellow-500":"text-red-500",y=n=>n>=70?"bg-green-500/20":n>=40?"bg-yellow-500/20":"bg-red-500/20";return m?e.jsxs("div",{className:"content-card animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(z,{className:"text-purple-500",size:18}),e.jsx("h3",{className:"section-heading text-base !mb-0",children:"AI Insights"})]}),e.jsx("div",{className:"h-24 bg-hover-bg rounded-lg"})]}):r?e.jsxs("div",{className:"content-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-purple-500",size:18}),e.jsx("h3",{className:"section-heading text-base !mb-0",children:"AI Insights"})]}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full ${y(r.healthScore)}`,children:[e.jsx(te,{size:14,className:d(r.healthScore)}),e.jsxs("span",{className:`text-sm font-semibold ${d(r.healthScore)}`,children:[r.healthScore,"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-hover-bg rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-text-secondary mb-1",children:["Month vs Month",r.keyMetrics.monthOverMonth>=0?e.jsx(W,{size:12,className:"text-green-500"}):e.jsx(Z,{size:12,className:"text-red-500"})]}),e.jsxs("span",{className:`text-lg font-bold ${r.keyMetrics.monthOverMonth>=0?"text-green-500":"text-red-500"}`,children:[r.keyMetrics.monthOverMonth>=0?"+":"",r.keyMetrics.monthOverMonth,"%"]})]}),e.jsxs("div",{className:"bg-hover-bg rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Active Members"}),e.jsxs("span",{className:"text-lg font-bold text-text-primary",children:[r.keyMetrics.activeMemberRate,"%"]})]})]}),e.jsx("div",{className:"space-y-2",children:r.predictions.map(n=>e.jsx("div",{className:`p-3 rounded-lg border transition-all ${n.actionable?"border-yellow-500/50 bg-yellow-500/5":"border-border-color bg-hover-bg/50"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[u(n.trend),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm text-text-primary",children:n.title}),n.actionable&&e.jsx(fe,{size:12,className:"text-yellow-500"})]}),e.jsx("p",{className:"text-xs text-text-secondary mt-0.5",children:n.message}),n.action&&e.jsxs("p",{className:"text-xs text-purple-400 mt-1 flex items-center gap-1",children:[e.jsx(z,{size:10}),n.action]})]})]})},n.id))})]}):e.jsxs("div",{className:"content-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(z,{className:"text-purple-500",size:18}),e.jsx("h3",{className:"section-heading text-base !mb-0",children:"AI Insights"})]}),e.jsx("p",{className:"text-text-secondary text-sm",children:"Upload tithe data to see AI-powered predictions"})]})},Ze=()=>{const{transactionLog:t=[],memberDatabase:s={},onStartNewWeek:a,userProfile:r,onScanImage:c}=ye(),[m,l]=p.useState(""),u=Ne.useRef(null),[d,y]=p.useState(!1),n=we("scanAssembly"),[i,k]=p.useState(null),[A,I]=p.useState(""),[T,C]=p.useState(new Date().toLocaleString("default",{month:"long"})),[O,_]=p.useState("Week 1"),{chatHistory:j,chartData:M,isLoading:ae,error:re,initializeChat:q,sendMessage:ne}=Me("");p.useEffect(()=>{if(t.length>0||Object.keys(s).length>0){const h=t.length>0?t.sort((b,f)=>f.timestamp-b.timestamp)[0]:null,o=h?h.titheListData:[],v=h?h.assemblyName:"General";q(o,s,v)}},[t,s,q]);const L=p.useMemo(()=>{const h=new Date().getMonth(),o=new Date().getFullYear(),v=t.filter(g=>{const x=new Date(g.selectedDate);return x.getMonth()===h&&x.getFullYear()===o}).reduce((g,x)=>g+x.totalTitheAmount,0);let b=0;Object.values(s).forEach(g=>{g&&Array.isArray(g.data)&&g.data.forEach(x=>{if(x.firstSeenDate)try{const w=new Date(x.firstSeenDate);w.getMonth()===h&&w.getFullYear()===o&&b++}catch{}})});const f=Object.values(s).reduce((g,x)=>{var w;return g+(((w=x==null?void 0:x.data)==null?void 0:w.length)||0)},0),D=[...t].sort((g,x)=>x.timestamp-g.timestamp).slice(0,20);return{ytdTithe:v,ytdSouls:b,totalMembers:f,recentActivities:D}},[t,s]),ie=p.useMemo(()=>{const o=new Date,v={};for(let b=0;b<6;b++){const f=new Date(o);f.setDate(f.getDate()-b*7);const D=`Week of ${G(f)}`;v[D]=0}return t.forEach(b=>{const f=new Date(b.selectedDate);for(let D=0;D<6;D++){const g=new Date(o);g.setDate(g.getDate()-D*7);const x=new Date(g);x.setDate(x.getDate()-x.getDay());const w=new Date(x);if(w.setDate(w.getDate()+6),f>=x&&f<=w){const ge=`Week of ${G(g)}`;v[ge]+=b.totalTitheAmount;break}}}),Object.entries(v).map(([b,f])=>({label:b,count:f})).reverse()},[t]),Q=p.useMemo(()=>new Set(Object.keys(s).filter(h=>{var o,v;return((v=(o=s[h])==null?void 0:o.data)==null?void 0:v.length)>0})),[s]),le=()=>{m&&a(m)},oe=()=>{var h;(h=u.current)==null||h.click()},ce=h=>{var v;const o=((v=h.target.files)==null?void 0:v[0])||null;o&&(k(o),I(m||""),n.open({file:o,assembly:m||""})),h.target&&(h.target.value="")},de=()=>{if(!A){window.alert("Please select an assembly.");return}if(!T||!O){window.alert("Please select both a Target Month and Week for accurate scanning.");return}n.close(),c(i,A,T,O),k(null)},he={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},S={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},me=p.useMemo(()=>Object.values(s).flatMap(o=>(o==null?void 0:o.data)||[]).filter(o=>o.firstSeenDate).sort((o,v)=>{try{return new Date(v.firstSeenDate).getTime()-new Date(o.firstSeenDate).getTime()}catch{return 0}}).slice(0,20),[s]),xe=p.useMemo(()=>{const h=new Date().getHours();return h<12?"Good morning":h<18?"Good afternoon":"Good evening"},[]),ue=new Date().toLocaleString("default",{month:"long"});return e.jsxs(N.div,{className:"space-y-8",variants:he,initial:"hidden",animate:"visible",children:[e.jsxs(N.div,{variants:S,children:[e.jsxs("h1",{className:"text-3xl font-bold text-[var(--text-primary)]",children:[xe,r?`, ${r.name.split(" ")[0]}`:"","."]}),e.jsx("p",{className:"text-lg text-[var(--text-secondary)]",children:"Here's your district's overview for today."})]}),e.jsx(N.div,{variants:S,children:e.jsx(We,{ytdTithe:L.ytdTithe,ytdSouls:L.ytdSouls,totalMembers:L.totalMembers,currentMonth:ue})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx(N.div,{variants:S,className:"lg:col-span-2",children:e.jsx(Ie,{selectedAssembly:m,setSelectedAssembly:l,assembliesWithData:Q,memberDatabaseEmpty:Object.keys(s).length===0,onStartWeek:le,onScanClick:oe,imageInputRef:u,onImageChange:ce})}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(N.div,{variants:S,children:e.jsx(_e,{transactionLogs:t,memberDatabase:s,apiKey:""})}),e.jsx(N.div,{variants:S,children:e.jsx(Ce,{members:me})}),e.jsx(N.div,{variants:S,children:e.jsx(Oe,{activities:L.recentActivities})})]}),e.jsx(N.div,{variants:S,className:"lg:col-span-3",children:e.jsx(ze,{data:ie})})]}),e.jsx(Se,{chatHistory:j,chartData:M,isLoading:ae,error:re,onSendMessage:ne,isOpen:d,onToggle:()=>y(!d)}),e.jsx($e,{isOpen:n.isOpen,onClose:()=>{n.close(),k(null)},scanAssembly:A,setScanAssembly:I,scanMonth:T,setScanMonth:C,scanWeek:O,setScanWeek:_,assembliesWithData:Q,onConfirm:de})]})};export{Ze as default};
