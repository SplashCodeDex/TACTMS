import{c as D,j as t,m as j,r as v,A as k,P as S,e as P,U as G}from"./index-BF_LplU2.js";import{S as T,A as $,D as L,T as w}from"./AnimatedNumber-CBlLLPbq.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=D("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),b=j.path,W=j.circle,O=({performanceData:x})=>{const y={top:20,right:30,bottom:40,left:60},d=800-y.left-y.right,s=300-y.top-y.bottom,o=Math.max(...x.map(e=>e.totalTithe),0),p=Math.max(...x.map(e=>e.soulsWon),0),A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g=(e,a)=>{if(a===0)return`M 0 ${s}`;let h=`M 0 ${s-x[0][e]/a*s}`;return x.forEach((l,m)=>{if(m>0){const M=m/11*d,C=s-l[e]/a*s;h+=` L ${M} ${C}`}}),h},r=(e,a)=>`${g(e,a)} L ${d} ${s} L 0 ${s} Z`,n=5,i=Array.from({length:n+1},(e,a)=>Math.ceil(o/n)*a),u=Math.min(5,p+1),c=p>0?Array.from({length:u+1},(e,a)=>Math.round(p/u*a)):[0];return t.jsxs("div",{className:"w-full overflow-x-auto",children:[t.jsxs("svg",{width:"100%",viewBox:"0 0 800 300","aria-label":"District performance trend chart",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"titheAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--primary-accent-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--primary-accent-start)",stopOpacity:"0"})]}),t.jsxs("linearGradient",{id:"soulsAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--success-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--success-start)",stopOpacity:"0"})]})]}),t.jsxs("g",{transform:`translate(${y.left}, ${y.top})`,children:[i.map(e=>t.jsx("line",{x1:"0",y1:s-e/o*s,x2:d,y2:s-e/o*s,className:"stroke-current text-[var(--border-color)]",strokeDasharray:"3,3"},`grid-${e}`)),t.jsx(b,{d:r("totalTithe",o),fill:"url(#titheAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2}}),t.jsx(b,{d:g("totalTithe",o),fill:"none",stroke:"var(--primary-accent-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut"}}),t.jsx(b,{d:r("soulsWon",p),fill:"url(#soulsAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4}}),t.jsx(b,{d:g("soulsWon",p),fill:"none",stroke:"var(--success-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut",delay:.2}}),x.map((e,a)=>t.jsxs("g",{transform:`translate(${a/11*d}, 0)`,children:[e.totalTithe>0&&t.jsx(W,{cy:s-e.totalTithe/o*s,r:"4",fill:"var(--primary-accent-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.5+a*.05},children:t.jsxs("title",{children:["GH₵ ",e.totalTithe.toLocaleString()]})}),e.soulsWon>0&&t.jsx(W,{cy:s-e.soulsWon/p*s,r:"4",fill:"var(--success-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.7+a*.05},children:t.jsxs("title",{children:[e.soulsWon," Souls Won"]})})]},`point-group-${a}`)),t.jsx("line",{x1:"0",y1:"0",x2:"0",y2:s,className:"stroke-current text-[var(--border-color-light)]"}),i.map(e=>t.jsx("text",{x:"-10",y:s-e/o*s+4,textAnchor:"end",className:"fill-current text-[var(--text-secondary)] text-xs",children:e>=1e3?`${(e/1e3).toFixed(1)}k`:e},`y-tick-tithe-${e}`)),t.jsx("text",{transform:`translate(-40, ${s/2}) rotate(-90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Total Tithe (GH₵)"}),t.jsx("line",{x1:d,y1:"0",x2:d,y2:s,className:"stroke-current text-[var(--border-color-light)]"}),c.map(e=>t.jsx("text",{x:d+10,y:s-e/p*s+4,textAnchor:"start",className:"fill-current text-[var(--text-secondary)] text-xs",children:e},`y-tick-souls-${e}`)),t.jsx("text",{transform:`translate(${d+y.right-15}, ${s/2}) rotate(90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Souls Won"}),t.jsx("line",{x1:"0",y1:s,x2:d,y2:s,className:"stroke-current text-[var(--border-color-light)]"}),A.map((e,a)=>t.jsx("text",{x:a/11*d,y:s+20,textAnchor:"middle",className:"fill-current text-[var(--text-secondary)] text-xs",children:e},`x-tick-${a}`))]})]}),t.jsxs("div",{className:"flex justify-center items-center gap-6 mt-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--primary-accent-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Total Tithe"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--success-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Souls Won"})]})]})]})},B=({transactionLog:x,memberDatabase:N})=>{const[f,y]=v.useState(new Date().getFullYear()),d=v.useMemo(()=>{const r=new Set(x.map(i=>new Date(i.timestamp).getFullYear())),n=new Date().getFullYear();return r.add(n),Array.from(r).sort((i,u)=>u-i)},[x]),s=v.useMemo(()=>{const r={};for(let n=0;n<12;n++)r[n]=k.map(i=>{var h;const c=(((h=N[i])==null?void 0:h.data)||[]).filter(l=>{if(!l.firstSeenDate)return!1;try{const m=new Date(l.firstSeenDate);return m.getMonth()===n&&m.getFullYear()===f}catch{return!1}}).length,a=x.filter(l=>{const m=new Date(l.selectedDate);return l.assemblyName===i&&m.getMonth()===n&&m.getFullYear()===f}).reduce((l,m)=>(l.totalTithe+=m.totalTitheAmount,l.titherCount+=m.titherCount,l.recordCount+=m.recordCount,l),{totalTithe:0,titherCount:0,recordCount:0});return{assemblyName:i,totalTithe:a.totalTithe,soulsWon:c,titherCount:a.titherCount,recordCount:a.recordCount}});return r},[x,N,f]),o=v.useMemo(()=>{const r={totalTithe:0,totalSouls:0,topPerformingAssembly:{name:"N/A",value:0},topGrowthAssembly:{name:"N/A",value:0},monthlyPerformance:Array(12).fill(0).map((c,e)=>({month:e,totalTithe:0,soulsWon:0}))},n=new Map;for(let c=0;c<12;c++){let e=0,a=0;s[c].forEach(h=>{e+=h.totalTithe,a+=h.soulsWon;const l=n.get(h.assemblyName)||{totalTithe:0,soulsWon:0};n.set(h.assemblyName,{totalTithe:l.totalTithe+h.totalTithe,soulsWon:l.soulsWon+h.soulsWon})}),r.totalTithe+=e,r.totalSouls+=a,r.monthlyPerformance[c]={month:c,totalTithe:e,soulsWon:a}}const i=[...n.entries()].sort((c,e)=>e[1].totalTithe-c[1].totalTithe);i.length>0&&i[0][1].totalTithe>0&&(r.topPerformingAssembly={name:i[0][0],value:i[0][1].totalTithe});const u=[...n.entries()].sort((c,e)=>e[1].soulsWon-c[1].soulsWon);return u.length>0&&u[0][1].soulsWon>0&&(r.topGrowthAssembly={name:u[0][0],value:u[0][1].soulsWon}),r},[s]),p=o.totalTithe>0||o.totalSouls>0,A={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.07}}},g={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return t.jsxs("div",{className:"space-y-8",children:[t.jsx("section",{className:"content-card","aria-labelledby":"reports-heading",children:t.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[t.jsxs("h2",{id:"reports-heading",className:"section-heading border-none pb-0 mb-0",children:[t.jsx(S,{size:22,className:"mr-3 icon-primary"}),"Annual Performance Dashboard"]}),t.jsx("div",{className:"flex items-center gap-4",children:t.jsx("select",{value:f,onChange:r=>y(Number(r.target.value)),className:"form-input-light",children:d.map(r=>t.jsx("option",{value:r,children:r},r))})})]})}),p?t.jsx(P,{children:t.jsxs(j.div,{className:"space-y-8",initial:"hidden",animate:"visible",variants:A,children:[t.jsxs(j.section,{variants:g,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(T,{icon:t.jsx(L,{}),label:`District Total Tithe (${f})`,value:t.jsxs(t.Fragment,{children:["GH₵ ",t.jsx($,{n:o.totalTithe,formatter:r=>r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]})}),t.jsx(T,{icon:t.jsx(G,{}),label:`District Souls Won (${f})`,value:t.jsx($,{n:o.totalSouls})}),t.jsx(T,{icon:t.jsx(w,{}),label:"Top Assembly (Tithe)",value:o.topPerformingAssembly.name,subValue:`GH₵ ${o.topPerformingAssembly.value.toLocaleString()}`,valueClassName:"text-gradient-primary"}),t.jsx(T,{icon:t.jsx(w,{}),label:"Top Assembly (Growth)",value:o.topGrowthAssembly.name,subValue:`${o.topGrowthAssembly.value} souls`,valueClassName:"text-gradient-primary"})]}),t.jsxs(j.section,{variants:g,className:"content-card",children:[t.jsxs("h3",{className:"section-heading",children:[t.jsx(F,{size:20,className:"mr-3 icon-primary"}),"District Performance Over Time (",f,")"]}),t.jsx(O,{performanceData:o.monthlyPerformance})]})]})}):t.jsxs("div",{className:"text-center py-12 content-card",children:[t.jsx(S,{size:52,className:"mx-auto text-[var(--text-muted)] mb-4 opacity-50"}),t.jsx("p",{className:"text-[var(--text-secondary)] text-lg",children:"No report data for this period."}),t.jsx("p",{className:"text-[var(--text-muted)] text-sm mt-1",children:'Download a processed list from the "Tithe Processor" view to populate reports.'})]})]})};export{B as default};
