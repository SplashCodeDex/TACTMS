import{c as M,j as t,m as v,A as _,h as P,u as O,r as b,L as E,q as $,k as F,U as q}from"./index-Bj-t18zv.js";import{S as w,A,D as R,T as D}from"./AnimatedNumber-CcR-J5Bi.js";import{c as z}from"./index-oECtIDYi.js";import{D as H}from"./download-BYuZBjMP.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=M("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),N=v.path,S=v.circle,I=({performanceData:n,granularity:x})=>{const a={top:20,right:30,bottom:40,left:60},y=800-a.left-a.right,e=300-a.top-a.bottom,r=Math.max(...n.map(o=>o.totalTithe),0),i=Math.max(...n.map(o=>o.soulsWon),0),u=(()=>{switch(x){case"yearly":case"monthly":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];case"weekly":return n.map(o=>`W${o.key}`);case"daily":return n.map(o=>o.key);default:return[]}})(),l=(o,c)=>{if(c===0)return`M 0 ${e}`;let T=`M 0 ${e-n[0][o]/c*e}`;return n.forEach((C,k)=>{if(k>0){const L=k/(n.length-1)*y,G=e-C[o]/c*e;T+=` L ${L} ${G}`}}),T},f=(o,c)=>`${l(o,c)} L ${y} ${e} L 0 ${e} Z`,p=5,g=Array.from({length:p+1},(o,c)=>Math.ceil(r/p)*c),j=Math.min(5,i+1),m=i>0?Array.from({length:j+1},(o,c)=>Math.round(i/j*c)):[0];return t.jsxs("div",{className:"w-full overflow-x-auto",children:[t.jsxs("svg",{width:"100%",viewBox:"0 0 800 300","aria-label":"District performance trend chart",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"titheAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--primary-accent-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--primary-accent-start)",stopOpacity:"0"})]}),t.jsxs("linearGradient",{id:"soulsAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--success-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--success-start)",stopOpacity:"0"})]})]}),t.jsxs("g",{transform:`translate(${a.left}, ${a.top})`,children:[g.map((o,c)=>t.jsx("line",{x1:"0",y1:r>0?e-o/r*e:e,x2:y,y2:r>0?e-o/r*e:e,className:"stroke-current text-[var(--border-color)]",strokeDasharray:"3,3"},`grid-${o}-${c}`)),t.jsx(N,{d:f("totalTithe",r),fill:"url(#titheAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2}}),t.jsx(N,{d:l("totalTithe",r),fill:"none",stroke:"var(--primary-accent-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut"}}),t.jsx(N,{d:f("soulsWon",i),fill:"url(#soulsAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4}}),t.jsx(N,{d:l("soulsWon",i),fill:"none",stroke:"var(--success-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut",delay:.2}}),n.map((o,c)=>t.jsxs("g",{transform:`translate(${c/(n.length-1)*y}, 0)`,children:[o.totalTithe>0&&t.jsx("g",{tabIndex:0,role:"button","aria-label":`Tithe for ${u[c]}: GH₵ ${o.totalTithe.toLocaleString()}`,className:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary-accent-start)] rounded-full",children:t.jsx(S,{cy:r>0?e-o.totalTithe/r*e:e,r:"4",fill:"var(--primary-accent-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.5+c*.05},children:t.jsxs("title",{children:["GH₵ ",o.totalTithe.toLocaleString()]})})}),o.soulsWon>0&&t.jsx("g",{tabIndex:0,role:"button","aria-label":`${o.soulsWon} souls won in ${u[c]}`,className:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--success-start)] rounded-full",children:t.jsx(S,{cy:i>0?e-o.soulsWon/i*e:e,r:"4",fill:"var(--success-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.7+c*.05},children:t.jsxs("title",{children:[o.soulsWon," Souls Won"]})})})]},`point-group-${c}`)),t.jsx("line",{x1:"0",y1:"0",x2:"0",y2:e,className:"stroke-current text-[var(--border-color-light)]"}),g.map((o,c)=>t.jsx("text",{x:"-10",y:r>0?e-o/r*e+4:e+4,textAnchor:"end",className:"fill-current text-[var(--text-secondary)] text-xs",children:o>=1e3?`${(o/1e3).toFixed(1)}k`:o},`y-tick-tithe-${o}-${c}`)),t.jsx("text",{transform:`translate(-40, ${e/2}) rotate(-90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Total Tithe (GH₵)"}),t.jsx("line",{x1:y,y1:"0",x2:y,y2:e,className:"stroke-current text-[var(--border-color-light)]"}),m.map(o=>t.jsx("text",{x:y+10,y:i>0?e-o/i*e+4:e+4,textAnchor:"start",className:"fill-current text-[var(--text-secondary)] text-xs",children:o},`y-tick-souls-${o}`)),t.jsx("text",{transform:`translate(${y+a.right-15}, ${e/2}) rotate(90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Souls Won"}),t.jsx("line",{x1:"0",y1:e,x2:y,y2:e,className:"stroke-current text-[var(--border-color-light)]"}),u.map((o,c)=>t.jsx("text",{x:c/(u.length-1)*y,y:e+20,textAnchor:"middle",className:"fill-current text-[var(--text-secondary)] text-xs",children:o},`x-tick-${c}`))]})]}),t.jsxs("div",{className:"flex justify-center items-center gap-6 mt-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--primary-accent-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Total Tithe"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--success-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Souls Won"})]})]})]})},W=n=>{const x=new Date(n.valueOf()),s=(n.getDay()+6)%7;x.setDate(x.getDate()-s+3);const d=x.valueOf();return x.setMonth(0,1),x.getDay()!==4&&x.setMonth(0,1+(4-x.getDay()+7)%7),1+Math.ceil((d-x.valueOf())/6048e5)},V=(n,x)=>{const s={},d=()=>_.map(a=>({assemblyName:a,totalTithe:0,soulsWon:0,titherCount:0,recordCount:0}));return n.forEach(a=>{const y=new Date(a.selectedDate),e=y.getFullYear(),r=y.getMonth(),i=W(y),h=y.getDate();s[e]||(s[e]={months:{},weeks:{},days:{}}),s[e].months[r]||(s[e].months[r]=d()),s[e].weeks[i]||(s[e].weeks[i]=d()),s[e].days[r]||(s[e].days[r]={}),s[e].days[r][h]||(s[e].days[r][h]=d());const u=s[e].months[r].find(p=>p.assemblyName===a.assemblyName),l=s[e].weeks[i].find(p=>p.assemblyName===a.assemblyName),f=s[e].days[r][h].find(p=>p.assemblyName===a.assemblyName);u&&(u.totalTithe+=a.totalTitheAmount,u.titherCount+=a.titherCount,u.recordCount+=a.recordCount),l&&(l.totalTithe+=a.totalTitheAmount,l.titherCount+=a.titherCount,l.recordCount+=a.recordCount),f&&(f.totalTithe+=a.totalTitheAmount,f.titherCount+=a.titherCount,f.recordCount+=a.recordCount)}),Object.keys(x).forEach(a=>{var e;(((e=x[a])==null?void 0:e.data)||[]).forEach(r=>{if(r.firstSeenDate)try{const i=new Date(r.firstSeenDate),h=i.getFullYear(),u=i.getMonth(),l=W(i),f=i.getDate();if(s[h]){if(s[h].months[u]){const p=s[h].months[u].find(g=>g.assemblyName===a);p&&(p.soulsWon+=1)}if(s[h].weeks[l]){const p=s[h].weeks[l].find(g=>g.assemblyName===a);p&&(p.soulsWon+=1)}if(s[h].days[u]&&s[h].days[u][f]){const p=s[h].days[u][f].find(g=>g.assemblyName===a);p&&(p.soulsWon+=1)}}}catch{}})}),s},B=(n,x)=>{const s={totalTithe:0,totalSouls:0,topPerformingAssembly:{name:"N/A",value:0},topGrowthAssembly:{name:"N/A",value:0},performance:[]},d=new Map;x==="days"?Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(r=>{let i=0,h=0;n[e][r].forEach(u=>{i+=u.totalTithe,h+=u.soulsWon;const l=d.get(u.assemblyName)||{totalTithe:0,soulsWon:0};d.set(u.assemblyName,{totalTithe:l.totalTithe+u.totalTithe,soulsWon:l.soulsWon+u.soulsWon})}),s.totalTithe+=i,s.totalSouls+=h,s.performance.push({key:`${e}/${r}`,totalTithe:i,soulsWon:h})})}):Object.keys(n).forEach(e=>{let r=0,i=0;n[e].forEach(h=>{r+=h.totalTithe,i+=h.soulsWon;const u=d.get(h.assemblyName)||{totalTithe:0,soulsWon:0};d.set(h.assemblyName,{totalTithe:u.totalTithe+h.totalTithe,soulsWon:u.soulsWon+h.soulsWon})}),s.totalTithe+=r,s.totalSouls+=i,s.performance.push({key:e,totalTithe:r,soulsWon:i})});const a=[...d.entries()].sort((e,r)=>r[1].totalTithe-e[1].totalTithe);a.length>0&&a[0][1].totalTithe>0&&(s.topPerformingAssembly={name:a[0][0],value:a[0][1].totalTithe});const y=[...d.entries()].sort((e,r)=>r[1].soulsWon-e[1].soulsWon);return y.length>0&&y[0][1].soulsWon>0&&(s.topGrowthAssembly={name:y[0][0],value:y[0][1].soulsWon}),s},U=(n,x,s)=>{let d="data:text/csv;charset=utf-8,";return d+=`Summary for ${x}
`,d+=`Total Tithe,Total Souls Won
`,d+=`${n.totalTithe},${n.totalSouls}

`,d+=`Top Performing Assembly (Tithe),${n.topPerformingAssembly.name},${n.topPerformingAssembly.value}
`,d+=`Top Performing Assembly (Growth),${n.topGrowthAssembly.name},${n.topGrowthAssembly.value}

`,d+=`Performance Data (${s})
`,d+=`Period,Total Tithe,Souls Won
`,n.performance.forEach(a=>{d+=`${a.key},${a.totalTithe},${a.soulsWon}
`}),d},J=z("relative inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium cursor-pointer overflow-hidden disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-	iger]):size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive [background:_linear-gradient(var(--liquid-button-color)_0_0)_no-repeat_calc(200%-var(--liquid-button-fill,0%))_100%/200%_var(--liquid-button-fill,0.2em)] hover:[--liquid-button-fill:100%] hover:[--liquid-button-delay:0.3s] [transition:_background_0.3s_var(--liquid-button-delay,0s),_color_0.3s_var(--liquid-button-delay,0s),_background-position_0.3s_calc(0.3s_-_var(--liquid-button-delay,0s))] focus:outline-none",{variants:{variant:{default:"text-white hover:text-white",outline:"border !bg-background dark:!bg-input/30 dark:border-input [--liquid-button-color:var(--primary)]",secondary:"text-secondary hover:text-secondary-foreground !bg-muted [--liquid-button-color:var(--secondary)]"},size:{default:"h-10 px-4 py-2 has-[>svg]:px-3",sm:"h-9 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-12 rounded-xl px-8 has-[>svg]:px-6",icon:"size-10"}},defaultVariants:{variant:"default",size:"default"}});function X({className:n,variant:x,size:s,...d}){return t.jsx(v.button,{whileTap:{scale:.95},whileHover:{scale:1.05},className:P(J({variant:x,size:s,className:n})),...d})}const Z=n=>{switch(n){case"yearly":case"monthly":return"months";case"weekly":return"weeks";case"daily":return"days"}},st=()=>{const{transactionLog:n=[],memberDatabase:x={}}=O(),[s,d]=b.useState(new Date().getFullYear()),[a,y]=b.useState("monthly"),[e,r]=b.useState(!0),i=b.useMemo(()=>V(n,x),[n,x]);b.useEffect(()=>{r(!0);const m=setTimeout(()=>{r(!1)},500);return()=>clearTimeout(m)},[i]);const h=b.useMemo(()=>{const m=new Set(Object.keys(i).map(Number)),o=new Date().getFullYear();return m.add(o),Array.from(m).sort((c,T)=>T-c)},[i]),u=b.useMemo(()=>{const m=i[s];if(!m)return{};switch(a){case"yearly":return m.months;case"monthly":return m.months;case"weekly":return m.weeks;case"daily":return m.days;default:return m.months}},[s,i,a]),l=b.useMemo(()=>B(u,Z(a)),[u,a]),f=()=>{const m=U(l,s,a),o=encodeURI(m),c=document.createElement("a");c.setAttribute("href",o),c.setAttribute("download",`report_${s}_${a}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c)},p=l.totalTithe>0||l.totalSouls>0,g={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.07}}},j={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return e?t.jsx(E,{text:"Processing report data..."}):t.jsxs("div",{className:"space-y-8",children:[t.jsx("section",{className:"content-card","aria-labelledby":"reports-heading",children:t.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[t.jsxs("h2",{id:"reports-heading",className:"section-heading border-none pb-0 mb-0",children:[t.jsx($,{size:22,className:"mr-3 icon-primary"}),"Annual Performance Dashboard"]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("select",{value:s,onChange:m=>d(Number(m.target.value)),className:"form-input-light",children:h.map(m=>t.jsx("option",{value:m,children:m},m))}),t.jsxs("select",{value:a,onChange:m=>y(m.target.value),className:"form-input-light",children:[t.jsx("option",{value:"yearly",children:"Yearly"}),t.jsx("option",{value:"monthly",children:"Monthly"}),t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"daily",children:"Daily"})]}),t.jsxs(X,{onClick:f,children:[t.jsx(H,{size:16,className:"mr-2"}),"Download CSV"]})]})]})}),p?t.jsx(F,{children:t.jsxs(v.div,{className:"space-y-8",initial:"hidden",animate:"visible",variants:g,children:[t.jsxs(v.section,{variants:j,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(w,{icon:t.jsx(R,{}),label:`District Total Tithe (${s})`,value:t.jsxs(t.Fragment,{children:["GH₵"," ",t.jsx(A,{n:l.totalTithe,formatter:m=>m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),ariaLabel:`District Total Tithe for ${s}: GH₵ ${l.totalTithe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsx(w,{icon:t.jsx(q,{}),label:`District Souls Won (${s})`,value:t.jsx(A,{n:l.totalSouls}),ariaLabel:`District Souls Won for ${s}: ${l.totalSouls}`}),t.jsx(w,{icon:t.jsx(D,{}),label:"Top Assembly (Tithe)",value:l.topPerformingAssembly.name,subValue:`GH₵ ${l.topPerformingAssembly.value.toLocaleString()}`,valueClassName:"text-gradient-primary",ariaLabel:`Top Assembly by Tithe: ${l.topPerformingAssembly.name} with GH₵ ${l.topPerformingAssembly.value.toLocaleString()}`}),t.jsx(w,{icon:t.jsx(D,{}),label:"Top Assembly (Growth)",value:l.topGrowthAssembly.name,subValue:`${l.topGrowthAssembly.value} souls`,valueClassName:"text-gradient-primary",ariaLabel:`Top Assembly by Growth: ${l.topGrowthAssembly.name} with ${l.topGrowthAssembly.value} souls`})]}),t.jsxs(v.section,{variants:j,className:"content-card",children:[t.jsxs("h3",{className:"section-heading",children:[t.jsx(Y,{size:20,className:"mr-3 icon-primary"}),"District Performance Over Time (",s,")"]}),t.jsx(I,{performanceData:l.performance,granularity:a})]})]})}):t.jsxs("div",{className:"text-center py-12 content-card",children:[t.jsx($,{size:52,className:"mx-auto text-[var(--text-muted)] mb-4 opacity-50"}),t.jsx("p",{className:"text-[var(--text-secondary)] text-lg",children:"No report data for this period."}),t.jsx("p",{className:"text-[var(--text-muted)] text-sm mt-1",children:'Download a processed list from the "Tithe Processor" view to populate reports.'})]})]})};export{st as default};
