import{c as R,j as t,m as T,A as Y,u as I,r as b,L as H,P as k,S as D,a as W,b as C,d as L,e as v,t as V,U as B}from"./index-DZWb2RdV.js";import{S as w,A as G,D as U,T as P}from"./AnimatedNumber-C0SGcrXi.js";import{L as z,D as _}from"./LiquidButton-pVg8ViAJ.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=R("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),$=T.path,M=T.circle,X=({performanceData:i,granularity:u})=>{const a={top:20,right:30,bottom:40,left:60},c=800-a.left-a.right,e=300-a.top-a.bottom,n=Math.max(...i.map(s=>s.totalTithe),0),h=Math.max(...i.map(s=>s.soulsWon),0),r=(()=>{switch(u){case"yearly":case"monthly":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];case"weekly":return i.map(s=>`W${s.key}`);case"daily":return i.map(s=>s.key);default:return[]}})(),p=(s,l)=>{if(l===0)return`M 0 ${e}`;let x=`M 0 ${e-i[0][s]/l*e}`;return i.forEach((j,S)=>{if(S>0){const E=S/(i.length-1)*c,F=e-j[s]/l*e;x+=` L ${E} ${F}`}}),x},f=(s,l)=>`${p(s,l)} L ${c} ${e} L 0 ${e} Z`,y=5,g=Array.from({length:y+1},(s,l)=>Math.ceil(n/y)*l),N=Math.min(5,h+1),A=h>0?Array.from({length:N+1},(s,l)=>Math.round(h/N*l)):[0];return t.jsxs("div",{className:"w-full overflow-x-auto",children:[t.jsxs("svg",{width:"100%",viewBox:"0 0 800 300","aria-label":"District performance trend chart",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"titheAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--primary-accent-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--primary-accent-start)",stopOpacity:"0"})]}),t.jsxs("linearGradient",{id:"soulsAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--success-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--success-start)",stopOpacity:"0"})]})]}),t.jsxs("g",{transform:`translate(${a.left}, ${a.top})`,children:[g.map((s,l)=>t.jsx("line",{x1:"0",y1:n>0?e-s/n*e:e,x2:c,y2:n>0?e-s/n*e:e,className:"stroke-current text-[var(--border-color)]",strokeDasharray:"3,3"},`grid-${s}-${l}`)),t.jsx($,{d:f("totalTithe",n),fill:"url(#titheAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2}}),t.jsx($,{d:p("totalTithe",n),fill:"none",stroke:"var(--primary-accent-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut"}}),t.jsx($,{d:f("soulsWon",h),fill:"url(#soulsAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4}}),t.jsx($,{d:p("soulsWon",h),fill:"none",stroke:"var(--success-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut",delay:.2}}),i.map((s,l)=>t.jsxs("g",{transform:`translate(${l/(i.length-1)*c}, 0)`,children:[s.totalTithe>0&&t.jsx("g",{tabIndex:0,role:"button","aria-label":`Tithe for ${r[l]}: GH₵ ${s.totalTithe.toLocaleString()}`,className:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary-accent-start)] rounded-full",children:t.jsx(M,{cy:n>0?e-s.totalTithe/n*e:e,r:"4",fill:"var(--primary-accent-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.5+l*.05},children:t.jsxs("title",{children:["GH₵ ",s.totalTithe.toLocaleString()]})})}),s.soulsWon>0&&t.jsx("g",{tabIndex:0,role:"button","aria-label":`${s.soulsWon} souls won in ${r[l]}`,className:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--success-start)] rounded-full",children:t.jsx(M,{cy:h>0?e-s.soulsWon/h*e:e,r:"4",fill:"var(--success-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.7+l*.05},children:t.jsxs("title",{children:[s.soulsWon," Souls Won"]})})})]},`point-group-${l}`)),t.jsx("line",{x1:"0",y1:"0",x2:"0",y2:e,className:"stroke-current text-[var(--border-color-light)]"}),g.map((s,l)=>t.jsx("text",{x:"-10",y:n>0?e-s/n*e+4:e+4,textAnchor:"end",className:"fill-current text-[var(--text-secondary)] text-xs",children:s>=1e3?`${(s/1e3).toFixed(1)}k`:s},`y-tick-tithe-${s}-${l}`)),t.jsx("text",{transform:`translate(-40, ${e/2}) rotate(-90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Total Tithe (GH₵)"}),t.jsx("line",{x1:c,y1:"0",x2:c,y2:e,className:"stroke-current text-[var(--border-color-light)]"}),A.map(s=>t.jsx("text",{x:c+10,y:h>0?e-s/h*e+4:e+4,textAnchor:"start",className:"fill-current text-[var(--text-secondary)] text-xs",children:s},`y-tick-souls-${s}`)),t.jsx("text",{transform:`translate(${c+a.right-15}, ${e/2}) rotate(90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Souls Won"}),t.jsx("line",{x1:"0",y1:e,x2:c,y2:e,className:"stroke-current text-[var(--border-color-light)]"}),r.map((s,l)=>t.jsx("text",{x:l/(r.length-1)*c,y:e+20,textAnchor:"middle",className:"fill-current text-[var(--text-secondary)] text-xs",children:s},`x-tick-${l}`))]})]}),t.jsxs("div",{className:"flex justify-center items-center gap-6 mt-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--primary-accent-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Total Tithe"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--success-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Souls Won"})]})]})]})},O=i=>{const u=new Date(i.valueOf()),o=(i.getDay()+6)%7;u.setDate(u.getDate()-o+3);const d=u.valueOf();return u.setMonth(0,1),u.getDay()!==4&&u.setMonth(0,1+(4-u.getDay()+7)%7),1+Math.ceil((d-u.valueOf())/6048e5)},q=(i,u)=>{const o={},d=()=>Y.map(a=>({assemblyName:a,totalTithe:0,soulsWon:0,titherCount:0,recordCount:0}));return i.forEach(a=>{const c=new Date(a.selectedDate),e=c.getFullYear(),n=c.getMonth(),h=O(c),m=c.getDate();o[e]||(o[e]={months:{},weeks:{},days:{}}),o[e].months[n]||(o[e].months[n]=d()),o[e].weeks[h]||(o[e].weeks[h]=d()),o[e].days[n]||(o[e].days[n]={}),o[e].days[n][m]||(o[e].days[n][m]=d());const r=o[e].months[n].find(y=>y.assemblyName===a.assemblyName),p=o[e].weeks[h].find(y=>y.assemblyName===a.assemblyName),f=o[e].days[n][m].find(y=>y.assemblyName===a.assemblyName);r&&(r.totalTithe+=a.totalTitheAmount,r.titherCount+=a.titherCount,r.recordCount+=a.recordCount),p&&(p.totalTithe+=a.totalTitheAmount,p.titherCount+=a.titherCount,p.recordCount+=a.recordCount),f&&(f.totalTithe+=a.totalTitheAmount,f.titherCount+=a.titherCount,f.recordCount+=a.recordCount)}),Object.keys(u).forEach(a=>{var e;(((e=u[a])==null?void 0:e.data)||[]).forEach(n=>{if(n.firstSeenDate)try{const h=new Date(n.firstSeenDate),m=h.getFullYear(),r=h.getMonth(),p=O(h),f=h.getDate();if(o[m]){if(o[m].months[r]){const y=o[m].months[r].find(g=>g.assemblyName===a);y&&(y.soulsWon+=1)}if(o[m].weeks[p]){const y=o[m].weeks[p].find(g=>g.assemblyName===a);y&&(y.soulsWon+=1)}if(o[m].days[r]&&o[m].days[r][f]){const y=o[m].days[r][f].find(g=>g.assemblyName===a);y&&(y.soulsWon+=1)}}}catch{}})}),o},Z=(i,u)=>{const o={totalTithe:0,totalSouls:0,topPerformingAssembly:{name:"N/A",value:0},topGrowthAssembly:{name:"N/A",value:0},performance:[]},d=new Map;u==="days"?Object.keys(i).forEach(e=>{Object.keys(i[e]).forEach(n=>{let h=0,m=0;i[e][n].forEach(r=>{h+=r.totalTithe,m+=r.soulsWon;const p=d.get(r.assemblyName)||{totalTithe:0,soulsWon:0};d.set(r.assemblyName,{totalTithe:p.totalTithe+r.totalTithe,soulsWon:p.soulsWon+r.soulsWon})}),o.totalTithe+=h,o.totalSouls+=m,o.performance.push({key:`${e}/${n}`,totalTithe:h,soulsWon:m})})}):Object.keys(i).forEach(e=>{let n=0,h=0;i[e].forEach(m=>{n+=m.totalTithe,h+=m.soulsWon;const r=d.get(m.assemblyName)||{totalTithe:0,soulsWon:0};d.set(m.assemblyName,{totalTithe:r.totalTithe+m.totalTithe,soulsWon:r.soulsWon+m.soulsWon})}),o.totalTithe+=n,o.totalSouls+=h,o.performance.push({key:e,totalTithe:n,soulsWon:h})});const a=[...d.entries()].sort((e,n)=>n[1].totalTithe-e[1].totalTithe);a.length>0&&a[0][1].totalTithe>0&&(o.topPerformingAssembly={name:a[0][0],value:a[0][1].totalTithe});const c=[...d.entries()].sort((e,n)=>n[1].soulsWon-e[1].soulsWon);return c.length>0&&c[0][1].soulsWon>0&&(o.topGrowthAssembly={name:c[0][0],value:c[0][1].soulsWon}),o},Q=(i,u,o)=>{let d="data:text/csv;charset=utf-8,";const a=c=>{if(c==null)return"";let e=String(c);return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${e.replace(/"/g,'""')}"`:e};return d+=`Summary for ${u}
`,d+=`Total Tithe,Total Souls Won
`,d+=`${a(i.totalTithe)},${a(i.totalSouls)}

`,d+=`Top Performing Assembly (Tithe),${a(i.topPerformingAssembly.name)},${a(i.topPerformingAssembly.value)}
`,d+=`Top Performing Assembly (Growth),${a(i.topGrowthAssembly.name)},${a(i.topGrowthAssembly.value)}

`,d+=`Performance Data (${o})
`,d+=`Period,Total Tithe,Souls Won
`,i.performance.forEach(c=>{d+=`${a(c.key)},${a(c.totalTithe)},${a(c.soulsWon)}
`}),d},K=i=>{switch(i){case"yearly":case"monthly":return"months";case"weekly":return"weeks";case"daily":return"days"}},at=()=>{const{transactionLog:i=[],memberDatabase:u={}}=I(),[o,d]=b.useState(new Date().getFullYear()),[a,c]=b.useState("monthly"),[e,n]=b.useState(!0),[h,m]=b.useState({}),[r,p]=b.useState(null),f=b.useMemo(()=>{const s=new Set(Object.keys(h).map(Number)),l=new Date().getFullYear();return s.add(l),Array.from(s).sort((x,j)=>j-x)},[h]);b.useEffect(()=>{n(!0);const s=q(i,u);m(s);const l=s[o];if(!l){p({totalTithe:0,totalSouls:0,topPerformingAssembly:{name:"N/A",value:0},topGrowthAssembly:{name:"N/A",value:0},performance:[]}),n(!1);return}let x;switch(a){case"yearly":x=l.months;break;case"monthly":x=l.months;break;case"weekly":x=l.weeks;break;case"daily":x=l.days;break;default:x=l.months}const j=Z(x,K(a));p(j),n(!1)},[i,u,o,a]);const y=()=>{if(!r)return;const s=Q(r,o,a),l=encodeURI(s),x=document.createElement("a");x.setAttribute("href",l),x.setAttribute("download",`report_${o}_${a}.csv`),document.body.appendChild(x),x.click(),document.body.removeChild(x)},g=r&&(r.totalTithe>0||r.totalSouls>0),N={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.07}}},A={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return e?t.jsx(H,{text:"Processing report data..."}):t.jsxs("div",{className:"space-y-8",children:[t.jsx("section",{className:"content-card","aria-labelledby":"reports-heading",children:t.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[t.jsxs("h2",{id:"reports-heading",className:"section-heading border-none pb-0 mb-0",children:[t.jsx(k,{size:22,className:"mr-3 icon-primary"}),"Annual Performance Dashboard"]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(D,{value:String(o),onValueChange:s=>d(Number(s)),children:[t.jsx(W,{className:"w-[100px]",children:t.jsx(C,{placeholder:"Year"})}),t.jsx(L,{className:"glassmorphism-bg border border-[var(--border-color)] rounded-xl",children:f.map(s=>t.jsx(v,{value:String(s),children:s},s))})]}),t.jsxs(D,{value:a,onValueChange:s=>c(s),children:[t.jsx(W,{className:"w-[120px]",children:t.jsx(C,{placeholder:"Granularity"})}),t.jsxs(L,{className:"glassmorphism-bg border border-[var(--border-color)] rounded-xl",children:[t.jsx(v,{value:"yearly",children:"Yearly"}),t.jsx(v,{value:"monthly",children:"Monthly"}),t.jsx(v,{value:"weekly",children:"Weekly"}),t.jsx(v,{value:"daily",children:"Daily"})]})]}),t.jsxs(z,{onClick:y,children:[t.jsx(_,{size:16,className:"mr-2"}),"Download CSV"]})]})]})}),g&&r?t.jsx(V,{children:t.jsxs(T.div,{className:"space-y-8",initial:"hidden",animate:"visible",variants:N,children:[t.jsxs(T.section,{variants:A,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(w,{icon:t.jsx(U,{}),label:`District Total Tithe (${o})`,value:t.jsxs(t.Fragment,{children:["GH₵"," ",t.jsx(G,{n:r.totalTithe,formatter:s=>s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),ariaLabel:`District Total Tithe for ${o}: GH₵ ${r.totalTithe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsx(w,{icon:t.jsx(B,{}),label:`District Souls Won (${o})`,value:t.jsx(G,{n:r.totalSouls}),ariaLabel:`District Souls Won for ${o}: ${r.totalSouls}`}),t.jsx(w,{icon:t.jsx(P,{}),label:"Top Assembly (Tithe)",value:r.topPerformingAssembly.name,subValue:`GH₵ ${r.topPerformingAssembly.value.toLocaleString()}`,valueClassName:"text-gradient-primary",ariaLabel:`Top Assembly by Tithe: ${r.topPerformingAssembly.name} with GH₵ ${r.topPerformingAssembly.value.toLocaleString()}`}),t.jsx(w,{icon:t.jsx(P,{}),label:"Top Assembly (Growth)",value:r.topGrowthAssembly.name,subValue:`${r.topGrowthAssembly.value} souls`,valueClassName:"text-gradient-primary",ariaLabel:`Top Assembly by Growth: ${r.topGrowthAssembly.name} with ${r.topGrowthAssembly.value} souls`})]}),t.jsxs(T.section,{variants:A,className:"content-card",children:[t.jsxs("h3",{className:"section-heading",children:[t.jsx(J,{size:20,className:"mr-3 icon-primary"}),"District Performance Over Time (",o,")"]}),t.jsx(X,{performanceData:r.performance,granularity:a})]})]})}):t.jsxs("div",{className:"text-center py-12 content-card",children:[t.jsx(k,{size:52,className:"mx-auto text-[var(--text-muted)] mb-4 opacity-50"}),t.jsx("p",{className:"text-[var(--text-secondary)] text-lg",children:"No report data for this period."}),t.jsx("p",{className:"text-[var(--text-muted)] text-sm mt-1",children:'Download a processed list from the "Tithe Processor" view to populate reports.'})]})]})};export{at as default};
