import{c as w,j as e,r as o,m as C,B as N,b as M,d as S,U as A}from"./index-TUc41L_N.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=w("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=w("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=w("MessageSquareQuote",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M8 12a2 2 0 0 0 2-2V8H8",key:"1jfesj"}],["path",{d:"M14 12a2 2 0 0 0 2-2V8h-2",key:"1dq9mh"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=w("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=w("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),G=()=>e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--bg-elevated)] animate-pulse flex-shrink-0"}),e.jsx("div",{className:"w-3/5",children:e.jsx("div",{className:"h-20 w-full rounded-lg bg-[var(--bg-elevated)] animate-pulse"})})]}),e.jsxs("div",{className:"flex items-end gap-3 flex-row-reverse",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--bg-elevated)] animate-pulse flex-shrink-0"}),e.jsx("div",{className:"w-1/2",children:e.jsx("div",{className:"h-12 w-full rounded-lg bg-[var(--bg-elevated)] animate-pulse"})})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--bg-elevated)] animate-pulse flex-shrink-0"}),e.jsx("div",{className:"w-4/5",children:e.jsx("div",{className:"h-28 w-full rounded-lg bg-[var(--bg-elevated)] animate-pulse"})})]})]}),_=()=>{const[r,a]=o.useState([]),[c,u]=o.useState([]),[i,x]=o.useState(!1),[n,d]=o.useState(null),l=o.useRef(null),y=o.useCallback(async(s,p,f,v,g,m)=>{{d("API Key for Gemini is not configured. Please contact support.");return}},[]),t=o.useCallback(async s=>{const p=l.current;if(!p){d("Chat is not initialized. Please start an analysis first.");return}x(!0);const f={role:"user",parts:[{text:s}]},v={role:"model",parts:[{text:""}],isLoading:!0};a(g=>[...g,f,v]);try{const g=await p.sendMessageStream({message:s});let m="";for await(const b of g)m+=b.text,a(h=>{const j=[...h];return j[j.length-1]={role:"model",parts:[{text:m}],isLoading:!0},j});a(b=>{const h=[...b];return h[h.length-1]={role:"model",parts:[{text:m}]},h})}catch(g){console.error("Gemini Send Message Error:",g);const m="Sorry, I encountered an error. Please try again.";a(b=>{const h=[...b];return h[h.length-1]={role:"model",parts:[{text:m}]},h})}finally{x(!1)}},[]);return{chatHistory:r,chartData:c,isLoading:i,error:n,startChat:y,sendMessage:t}},D=C.rect,P=C.text,q=({data:r})=>{if(!r||r.length===0)return e.jsx("p",{className:"text-center text-[var(--text-muted)] text-sm",children:"No chart data available."});const a=220,c=35,u=20,i=r.length*(c+u),x=Math.max(...r.map(n=>n.count),0);return e.jsx("div",{className:"bar-chart-container w-full overflow-x-auto pb-4",children:e.jsxs("svg",{width:i,height:a,"aria-label":"Contribution Distribution Chart",children:[e.jsx("g",{transform:"translate(0, 10)",children:r.map((n,d)=>{const l=x>0?n.count/x*(a-40):0;return e.jsxs("g",{transform:`translate(${d*(c+u)}, 0)`,children:[e.jsx("title",{children:`${n.label}: ${n.count} members`}),e.jsx(D,{className:"bar",x:0,y:a-30-l,width:c,height:l,fill:"url(#barGradient)",rx:"4",ry:"4",initial:{height:0,y:a-30},animate:{height:l,y:a-30-l},transition:{duration:.8,ease:[.22,1,.36,1],delay:d*.1}}),e.jsx(P,{className:"bar-value",x:c/2,y:a-35-l,textAnchor:"middle",initial:{opacity:0,y:a-30},animate:{opacity:1,y:a-35-l},transition:{duration:.8,ease:"easeOut",delay:d*.1+.3},children:n.count}),e.jsx("text",{className:"axis-text",x:c/2,y:a-15,textAnchor:"middle",children:n.label})]},n.label)})}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--primary-accent-hover-start)"}),e.jsx("stop",{offset:"100%",stopColor:"var(--primary-accent-start)"})]})})]})})},E=({chatHistory:r,isLoading:a,onSendMessage:c,suggestedPrompts:u})=>{const[i,x]=o.useState(""),n=o.useRef(null);o.useEffect(()=>{var t;(t=n.current)==null||t.scrollIntoView({behavior:"smooth"})},[r]);const d=t=>{t==null||t.preventDefault(),i.trim()&&!a&&(c(i.trim()),x(""))},l=t=>{c(t)},y=t=>{let s=t;return s=s.replace(/^### (.*$)/gm,'<h3 class="text-lg font-semibold text-[var(--text-primary)] mt-3 mb-1">$1</h3>'),s=s.replace(/^## (.*$)/gm,'<h2 class="text-xl font-bold text-gradient-primary mt-4 mb-2">$1</h2>'),s=s.replace(/^# (.*$)/gm,'<h1 class="text-2xl font-bold text-gradient-primary mt-5 mb-3">$1</h1>'),s=s.replace(/((?:^[*-] .*(?:\n|$))+)/gm,p=>`<ul class="list-outside mt-2">${p.trim().split(`
`).map(v=>`<li class="list-disc ml-5 mb-1.5">${v.replace(/^[*-] /,"").trim()}</li>`).join("")}</ul>`),s=s.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),s=s.replace(/__(.*?)__/g,"<strong>$1</strong>"),s=s.replace(/\*(.*?)\*/g,"<em>$1</em>"),s=s.replace(/_(.*?)_/g,"<em>$1</em>"),s=s.replace(/\n/g,"<br />"),s=s.replace(/<br \/>\s*(<(?:ul|ol|h[1-3]))/g,"$1"),s=s.replace(/(<\/(?:ul|ol|h[1-3])>)\s*<br \/>/g,"$1"),s};return e.jsxs("div",{className:"flex flex-col h-[60vh] md:h-[calc(100vh-250px)]",children:[e.jsxs("div",{className:"flex-grow overflow-y-auto pr-4 space-y-6",children:[r.map((t,s)=>e.jsx("div",{className:`chat-message ${t.role}`,children:e.jsx("div",{className:`chat-bubble ${t.role}`,children:t.isLoading&&t.parts[0].text===""?e.jsxs("div",{className:"typing-indicator px-2 py-1",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}):e.jsx("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:y(t.parts[0].text||"")}})})},s)),e.jsx("div",{ref:n})]}),e.jsxs("div",{className:"pt-4 mt-auto",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:u.map(t=>e.jsxs(N,{size:"sm",variant:"subtle",onClick:()=>l(t),disabled:a,children:[e.jsx(H,{size:14,className:"mr-1.5 text-[var(--primary-accent-end)]"})," ",t]},t))}),e.jsxs("form",{onSubmit:d,className:"flex items-center gap-3",children:[e.jsx("textarea",{value:i,onChange:t=>x(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&d(t)},placeholder:"Ask a follow-up question...",className:"form-input-light flex-grow !rounded-xl resize-none",rows:1,style:{maxHeight:"150px"},disabled:a}),e.jsx(N,{type:"submit",size:"icon",variant:"primary",disabled:a||!i.trim(),children:e.jsx(L,{size:18})})]})]})]})},W=({summary:r})=>{const a=r.replace(/\n/g,"<br />").replace(/\* \*\*(.*?)\*\*/g,'<li><strong class="text-[var(--primary-accent-start)]">$1</strong>').replace(/<\/strong>:(.*?)<br \/>/g,"</strong>:$1</li>").replace(/- \*\*(.*?)\*\*/g,'<li><strong class="text-[var(--primary-accent-start)]">$1</strong>').replace(/\*\*(.*?)\*\*/g,'<strong class="text-[var(--primary-accent-start)]">$1</strong>').replace(/- (.*?)(<br \/>|$)/g,'<li class="list-none ml-0 mb-1.5">$1</li>');return e.jsxs("div",{className:"content-card bg-[var(--bg-elevated)] border-l-4 border-[var(--primary-accent-start)]",children:[e.jsxs("h3",{className:"section-heading text-base !mb-3",children:[e.jsx(z,{size:18,className:"mr-3 icon-primary"}),"AI-Generated Summary"]}),e.jsx("ul",{className:"text-sm space-y-2 text-[var(--text-secondary)]",dangerouslySetInnerHTML:{__html:a}})]})},V=()=>e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((r,a)=>e.jsxs("div",{className:"p-4 bg-[var(--bg-card-subtle-accent)] rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-[var(--border-color)] rounded w-1/3 mb-3"}),e.jsx("div",{className:"h-3 bg-[var(--border-color)] rounded w-full mb-1"}),e.jsx("div",{className:"h-3 bg-[var(--border-color)] rounded w-5/6"})]},a))}),T=({reconciliationReport:r,addToast:a})=>{const[c,u]=o.useState([]),[i,x]=o.useState(!1),[n,d]=o.useState(null),l=(r==null?void 0:r.newMembers)||[],y=async()=>{if(l.length===0){a("No new members found in the current data to generate messages for.","warning");return}{a("AI features are not configured. Please contact support.","error");return}},t=s=>{navigator.clipboard.writeText(s).then(()=>{a("Message copied to clipboard!","success")}).catch(()=>{a("Failed to copy message.","error")})};return e.jsxs("section",{className:"content-card",children:[e.jsxs("h2",{className:"section-heading",children:[e.jsx(I,{size:22,className:"mr-3 icon-primary"}),"AI Outreach Assistant"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"outreach-target",className:"form-label",children:"Select Target Group"}),e.jsx("select",{id:"outreach-target",className:"form-input-light w-full",children:e.jsxs("option",{children:["New Members (Souls Won) (",l.length,")"]})})]}),e.jsx("div",{className:"self-end",children:e.jsx(N,{onClick:y,isLoading:i,disabled:l.length===0||i,variant:"secondary",fullWidth:!0,children:"Generate Welcome Messages"})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-[var(--border-color)]",children:[i&&e.jsx(V,{}),n&&e.jsxs("div",{className:"text-center py-6 text-[var(--danger-text)]",children:[e.jsx(S,{size:32,className:"mx-auto mb-2"}),e.jsx("p",{children:n})]}),!i&&!n&&c.length>0&&e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:c.map((s,p)=>e.jsxs("div",{className:"p-4 bg-[var(--bg-elevated)] rounded-lg border border-[var(--border-color)]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"font-semibold text-[var(--text-primary)] flex items-center gap-2",children:[e.jsx(A,{size:16})," ",s.memberName]}),e.jsx(N,{size:"sm",variant:"ghost",leftIcon:e.jsx($,{size:14}),onClick:()=>t(s.message),children:"Copy"})]}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] whitespace-pre-wrap",children:s.message})]},p))}),!i&&!n&&c.length===0&&e.jsx("div",{className:"text-center py-6 text-[var(--text-muted)]",children:l.length>0?"Click 'Generate' to create personalized welcome messages for your new members.":"No new members found in the current workspace. Upload and reconcile a new file to identify them."})]})]})},O=({titheListData:r,currentAssembly:a,selectedDate:c,addToast:u,tithersCount:i,nonTithersCount:x,totalAmount:n,reconciliationReport:d})=>{var j;const{chatHistory:l,chartData:y,isLoading:t,error:s,sendMessage:p}=_(),f=()=>{{u("AI feature is not configured.","error");return}},v=k=>{k.trim()&&p(k)},g=r.length>0,m=l.length>0,b=(j=l[0])==null?void 0:j.summary,h=["What are the key observations from this data?","Suggest some potential actions based on these numbers.","What if participation increased by 10%?",`How does ${a||"this assembly"} compare to typical patterns?`];return e.jsxs("div",{className:"space-y-8",children:[e.jsx(T,{reconciliationReport:d,addToast:u}),e.jsx("section",{className:"content-card",children:e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsxs("h2",{id:"analytics-heading",className:"section-heading border-none pb-0 mb-0",children:[e.jsx(M,{size:22,className:"mr-3 icon-primary"}),"AI-Powered Analytics Chat"]}),e.jsx(N,{onClick:f,disabled:!g||t,isLoading:t&&!m,variant:"primary",children:m?`Restart Analysis for ${a}`:"Analyze with AI"})]})}),e.jsxs("div",{className:"min-h-[400px]",children:[s&&e.jsxs("div",{className:"content-card text-center py-10 flex flex-col items-center",children:[e.jsx(S,{size:48,className:"text-[var(--danger-text)] mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-[var(--danger-text)]",children:"Analysis Failed"}),e.jsx("p",{className:"text-[var(--text-secondary)] mt-2 max-w-md",children:s})]}),!m&&!t&&!s&&e.jsxs("div",{className:"content-card text-center py-10 flex flex-col items-center animate-fadeIn",children:[e.jsx(M,{size:52,className:"mx-auto text-[var(--text-muted)] mb-4 opacity-50"}),e.jsx("h3",{className:"text-xl font-semibold text-[var(--text-primary)]",children:"Ready for Insights?"}),e.jsx("p",{className:"text-[var(--text-secondary)] mt-2 max-w-md",children:g?`You have a list for ${a} Assembly ready. Click "Analyze with AI" to start a conversation about your data.`:"Generate or load a tithe list in the Processor view, then come back here to get an AI-powered analysis."})]}),t&&!m&&e.jsx("div",{className:"content-card",children:e.jsx(G,{})}),m&&!s&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[b&&e.jsx(W,{summary:b}),e.jsx("div",{className:"content-card",children:e.jsx(E,{chatHistory:l,isLoading:t,onSendMessage:v,suggestedPrompts:h})})]}),e.jsx("div",{className:"lg:col-span-1 space-y-8 sticky top-8",children:y.length>0&&e.jsxs("div",{className:"content-card animate-fadeIn",children:[e.jsx("h3",{className:"section-heading text-base !mb-6",children:"Contribution Distribution"}),e.jsx(q,{data:y})]})})]})]})]})};export{O as default};
