import{c as P,j as t,m as v,A as _,k as M,t as O,u as E,r as b,L as F,y as $,s as q,U as R}from"./index-ryEH5VkR.js";import{S as k,A as S,D as z,T as D}from"./AnimatedNumber-oq8V70rv.js";import{D as H}from"./download-DL0HXw48.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=P("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),N=v.path,W=v.circle,I=({performanceData:i,granularity:m})=>{const a={top:20,right:30,bottom:40,left:60},c=800-a.left-a.right,e=300-a.top-a.bottom,n=Math.max(...i.map(s=>s.totalTithe),0),u=Math.max(...i.map(s=>s.soulsWon),0),r=(()=>{switch(m){case"yearly":case"monthly":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];case"weekly":return i.map(s=>`W${s.key}`);case"daily":return i.map(s=>s.key);default:return[]}})(),p=(s,l)=>{if(l===0)return`M 0 ${e}`;let x=`M 0 ${e-i[0][s]/l*e}`;return i.forEach((j,A)=>{if(A>0){const L=A/(i.length-1)*c,G=e-j[s]/l*e;x+=` L ${L} ${G}`}}),x},f=(s,l)=>`${p(s,l)} L ${c} ${e} L 0 ${e} Z`,y=5,g=Array.from({length:y+1},(s,l)=>Math.ceil(n/y)*l),T=Math.min(5,u+1),w=u>0?Array.from({length:T+1},(s,l)=>Math.round(u/T*l)):[0];return t.jsxs("div",{className:"w-full overflow-x-auto",children:[t.jsxs("svg",{width:"100%",viewBox:"0 0 800 300","aria-label":"District performance trend chart",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"titheAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--primary-accent-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--primary-accent-start)",stopOpacity:"0"})]}),t.jsxs("linearGradient",{id:"soulsAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--success-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--success-start)",stopOpacity:"0"})]})]}),t.jsxs("g",{transform:`translate(${a.left}, ${a.top})`,children:[g.map((s,l)=>t.jsx("line",{x1:"0",y1:n>0?e-s/n*e:e,x2:c,y2:n>0?e-s/n*e:e,className:"stroke-current text-[var(--border-color)]",strokeDasharray:"3,3"},`grid-${s}-${l}`)),t.jsx(N,{d:f("totalTithe",n),fill:"url(#titheAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2}}),t.jsx(N,{d:p("totalTithe",n),fill:"none",stroke:"var(--primary-accent-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut"}}),t.jsx(N,{d:f("soulsWon",u),fill:"url(#soulsAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4}}),t.jsx(N,{d:p("soulsWon",u),fill:"none",stroke:"var(--success-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut",delay:.2}}),i.map((s,l)=>t.jsxs("g",{transform:`translate(${l/(i.length-1)*c}, 0)`,children:[s.totalTithe>0&&t.jsx("g",{tabIndex:0,role:"button","aria-label":`Tithe for ${r[l]}: GH₵ ${s.totalTithe.toLocaleString()}`,className:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary-accent-start)] rounded-full",children:t.jsx(W,{cy:n>0?e-s.totalTithe/n*e:e,r:"4",fill:"var(--primary-accent-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.5+l*.05},children:t.jsxs("title",{children:["GH₵ ",s.totalTithe.toLocaleString()]})})}),s.soulsWon>0&&t.jsx("g",{tabIndex:0,role:"button","aria-label":`${s.soulsWon} souls won in ${r[l]}`,className:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--success-start)] rounded-full",children:t.jsx(W,{cy:u>0?e-s.soulsWon/u*e:e,r:"4",fill:"var(--success-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.7+l*.05},children:t.jsxs("title",{children:[s.soulsWon," Souls Won"]})})})]},`point-group-${l}`)),t.jsx("line",{x1:"0",y1:"0",x2:"0",y2:e,className:"stroke-current text-[var(--border-color-light)]"}),g.map((s,l)=>t.jsx("text",{x:"-10",y:n>0?e-s/n*e+4:e+4,textAnchor:"end",className:"fill-current text-[var(--text-secondary)] text-xs",children:s>=1e3?`${(s/1e3).toFixed(1)}k`:s},`y-tick-tithe-${s}-${l}`)),t.jsx("text",{transform:`translate(-40, ${e/2}) rotate(-90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Total Tithe (GH₵)"}),t.jsx("line",{x1:c,y1:"0",x2:c,y2:e,className:"stroke-current text-[var(--border-color-light)]"}),w.map(s=>t.jsx("text",{x:c+10,y:u>0?e-s/u*e+4:e+4,textAnchor:"start",className:"fill-current text-[var(--text-secondary)] text-xs",children:s},`y-tick-souls-${s}`)),t.jsx("text",{transform:`translate(${c+a.right-15}, ${e/2}) rotate(90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Souls Won"}),t.jsx("line",{x1:"0",y1:e,x2:c,y2:e,className:"stroke-current text-[var(--border-color-light)]"}),r.map((s,l)=>t.jsx("text",{x:l/(r.length-1)*c,y:e+20,textAnchor:"middle",className:"fill-current text-[var(--text-secondary)] text-xs",children:s},`x-tick-${l}`))]})]}),t.jsxs("div",{className:"flex justify-center items-center gap-6 mt-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--primary-accent-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Total Tithe"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--success-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Souls Won"})]})]})]})},C=i=>{const m=new Date(i.valueOf()),o=(i.getDay()+6)%7;m.setDate(m.getDate()-o+3);const d=m.valueOf();return m.setMonth(0,1),m.getDay()!==4&&m.setMonth(0,1+(4-m.getDay()+7)%7),1+Math.ceil((d-m.valueOf())/6048e5)},V=(i,m)=>{const o={},d=()=>_.map(a=>({assemblyName:a,totalTithe:0,soulsWon:0,titherCount:0,recordCount:0}));return i.forEach(a=>{const c=new Date(a.selectedDate),e=c.getFullYear(),n=c.getMonth(),u=C(c),h=c.getDate();o[e]||(o[e]={months:{},weeks:{},days:{}}),o[e].months[n]||(o[e].months[n]=d()),o[e].weeks[u]||(o[e].weeks[u]=d()),o[e].days[n]||(o[e].days[n]={}),o[e].days[n][h]||(o[e].days[n][h]=d());const r=o[e].months[n].find(y=>y.assemblyName===a.assemblyName),p=o[e].weeks[u].find(y=>y.assemblyName===a.assemblyName),f=o[e].days[n][h].find(y=>y.assemblyName===a.assemblyName);r&&(r.totalTithe+=a.totalTitheAmount,r.titherCount+=a.titherCount,r.recordCount+=a.recordCount),p&&(p.totalTithe+=a.totalTitheAmount,p.titherCount+=a.titherCount,p.recordCount+=a.recordCount),f&&(f.totalTithe+=a.totalTitheAmount,f.titherCount+=a.titherCount,f.recordCount+=a.recordCount)}),Object.keys(m).forEach(a=>{var e;(((e=m[a])==null?void 0:e.data)||[]).forEach(n=>{if(n.firstSeenDate)try{const u=new Date(n.firstSeenDate),h=u.getFullYear(),r=u.getMonth(),p=C(u),f=u.getDate();if(o[h]){if(o[h].months[r]){const y=o[h].months[r].find(g=>g.assemblyName===a);y&&(y.soulsWon+=1)}if(o[h].weeks[p]){const y=o[h].weeks[p].find(g=>g.assemblyName===a);y&&(y.soulsWon+=1)}if(o[h].days[r]&&o[h].days[r][f]){const y=o[h].days[r][f].find(g=>g.assemblyName===a);y&&(y.soulsWon+=1)}}}catch{}})}),o},B=(i,m)=>{const o={totalTithe:0,totalSouls:0,topPerformingAssembly:{name:"N/A",value:0},topGrowthAssembly:{name:"N/A",value:0},performance:[]},d=new Map;m==="days"?Object.keys(i).forEach(e=>{Object.keys(i[e]).forEach(n=>{let u=0,h=0;i[e][n].forEach(r=>{u+=r.totalTithe,h+=r.soulsWon;const p=d.get(r.assemblyName)||{totalTithe:0,soulsWon:0};d.set(r.assemblyName,{totalTithe:p.totalTithe+r.totalTithe,soulsWon:p.soulsWon+r.soulsWon})}),o.totalTithe+=u,o.totalSouls+=h,o.performance.push({key:`${e}/${n}`,totalTithe:u,soulsWon:h})})}):Object.keys(i).forEach(e=>{let n=0,u=0;i[e].forEach(h=>{n+=h.totalTithe,u+=h.soulsWon;const r=d.get(h.assemblyName)||{totalTithe:0,soulsWon:0};d.set(h.assemblyName,{totalTithe:r.totalTithe+h.totalTithe,soulsWon:r.soulsWon+h.soulsWon})}),o.totalTithe+=n,o.totalSouls+=u,o.performance.push({key:e,totalTithe:n,soulsWon:u})});const a=[...d.entries()].sort((e,n)=>n[1].totalTithe-e[1].totalTithe);a.length>0&&a[0][1].totalTithe>0&&(o.topPerformingAssembly={name:a[0][0],value:a[0][1].totalTithe});const c=[...d.entries()].sort((e,n)=>n[1].soulsWon-e[1].soulsWon);return c.length>0&&c[0][1].soulsWon>0&&(o.topGrowthAssembly={name:c[0][0],value:c[0][1].soulsWon}),o},U=(i,m,o)=>{let d="data:text/csv;charset=utf-8,";const a=c=>{if(c==null)return"";let e=String(c);return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${e.replace(/"/g,'""')}"`:e};return d+=`Summary for ${m}
`,d+=`Total Tithe,Total Souls Won
`,d+=`${a(i.totalTithe)},${a(i.totalSouls)}

`,d+=`Top Performing Assembly (Tithe),${a(i.topPerformingAssembly.name)},${a(i.topPerformingAssembly.value)}
`,d+=`Top Performing Assembly (Growth),${a(i.topGrowthAssembly.name)},${a(i.topGrowthAssembly.value)}

`,d+=`Performance Data (${o})
`,d+=`Period,Total Tithe,Souls Won
`,i.performance.forEach(c=>{d+=`${a(c.key)},${a(c.totalTithe)},${a(c.soulsWon)}
`}),d},J=O("relative inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium cursor-pointer overflow-hidden disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-	iger]):size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive [background:_linear-gradient(var(--liquid-button-color)_0_0)_no-repeat_calc(200%-var(--liquid-button-fill,0%))_100%/200%_var(--liquid-button-fill,0.2em)] hover:[--liquid-button-fill:100%] hover:[--liquid-button-delay:0.3s] [transition:_background_0.3s_var(--liquid-button-delay,0s),_color_0.3s_var(--liquid-button-delay,0s),_background-position_0.3s_calc(0.3s_-_var(--liquid-button-delay,0s))] focus:outline-none",{variants:{variant:{default:"text-white hover:text-white",outline:"border !bg-background dark:!bg-input/30 dark:border-input [--liquid-button-color:var(--primary)]",secondary:"text-secondary hover:text-secondary-foreground !bg-muted [--liquid-button-color:var(--secondary)]"},size:{default:"h-10 px-4 py-2 has-[>svg]:px-3",sm:"h-9 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-12 rounded-xl px-8 has-[>svg]:px-6",icon:"size-10"}},defaultVariants:{variant:"default",size:"default"}});function X({className:i,variant:m,size:o,...d}){return t.jsx(v.button,{whileTap:{scale:.95},whileHover:{scale:1.05},className:M(J({variant:m,size:o,className:i})),...d})}const Z=i=>{switch(i){case"yearly":case"monthly":return"months";case"weekly":return"weeks";case"daily":return"days"}},et=()=>{const{transactionLog:i=[],memberDatabase:m={}}=E(),[o,d]=b.useState(new Date().getFullYear()),[a,c]=b.useState("monthly"),[e,n]=b.useState(!0),[u,h]=b.useState({}),[r,p]=b.useState(null),f=b.useMemo(()=>{const s=new Set(Object.keys(u).map(Number)),l=new Date().getFullYear();return s.add(l),Array.from(s).sort((x,j)=>j-x)},[u]);b.useEffect(()=>{n(!0);const s=V(i,m);h(s);const l=s[o];if(!l){p({totalTithe:0,totalSouls:0,topPerformingAssembly:{name:"N/A",value:0},topGrowthAssembly:{name:"N/A",value:0},performance:[]}),n(!1);return}let x;switch(a){case"yearly":x=l.months;break;case"monthly":x=l.months;break;case"weekly":x=l.weeks;break;case"daily":x=l.days;break;default:x=l.months}const j=B(x,Z(a));p(j),n(!1)},[i,m,o,a]);const y=()=>{if(!r)return;const s=U(r,o,a),l=encodeURI(s),x=document.createElement("a");x.setAttribute("href",l),x.setAttribute("download",`report_${o}_${a}.csv`),document.body.appendChild(x),x.click(),document.body.removeChild(x)},g=r&&(r.totalTithe>0||r.totalSouls>0),T={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.07}}},w={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return e?t.jsx(F,{text:"Processing report data..."}):t.jsxs("div",{className:"space-y-8",children:[t.jsx("section",{className:"content-card","aria-labelledby":"reports-heading",children:t.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[t.jsxs("h2",{id:"reports-heading",className:"section-heading border-none pb-0 mb-0",children:[t.jsx($,{size:22,className:"mr-3 icon-primary"}),"Annual Performance Dashboard"]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("select",{value:o,onChange:s=>d(Number(s.target.value)),className:"form-input-light",children:f.map(s=>t.jsx("option",{value:s,children:s},s))}),t.jsxs("select",{value:a,onChange:s=>c(s.target.value),className:"form-input-light",children:[t.jsx("option",{value:"yearly",children:"Yearly"}),t.jsx("option",{value:"monthly",children:"Monthly"}),t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"daily",children:"Daily"})]}),t.jsxs(X,{onClick:y,children:[t.jsx(H,{size:16,className:"mr-2"}),"Download CSV"]})]})]})}),g&&r?t.jsx(q,{children:t.jsxs(v.div,{className:"space-y-8",initial:"hidden",animate:"visible",variants:T,children:[t.jsxs(v.section,{variants:w,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(k,{icon:t.jsx(z,{}),label:`District Total Tithe (${o})`,value:t.jsxs(t.Fragment,{children:["GH₵"," ",t.jsx(S,{n:r.totalTithe,formatter:s=>s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),ariaLabel:`District Total Tithe for ${o}: GH₵ ${r.totalTithe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsx(k,{icon:t.jsx(R,{}),label:`District Souls Won (${o})`,value:t.jsx(S,{n:r.totalSouls}),ariaLabel:`District Souls Won for ${o}: ${r.totalSouls}`}),t.jsx(k,{icon:t.jsx(D,{}),label:"Top Assembly (Tithe)",value:r.topPerformingAssembly.name,subValue:`GH₵ ${r.topPerformingAssembly.value.toLocaleString()}`,valueClassName:"text-gradient-primary",ariaLabel:`Top Assembly by Tithe: ${r.topPerformingAssembly.name} with GH₵ ${r.topPerformingAssembly.value.toLocaleString()}`}),t.jsx(k,{icon:t.jsx(D,{}),label:"Top Assembly (Growth)",value:r.topGrowthAssembly.name,subValue:`${r.topGrowthAssembly.value} souls`,valueClassName:"text-gradient-primary",ariaLabel:`Top Assembly by Growth: ${r.topGrowthAssembly.name} with ${r.topGrowthAssembly.value} souls`})]}),t.jsxs(v.section,{variants:w,className:"content-card",children:[t.jsxs("h3",{className:"section-heading",children:[t.jsx(Y,{size:20,className:"mr-3 icon-primary"}),"District Performance Over Time (",o,")"]}),t.jsx(I,{performanceData:r.performance,granularity:a})]})]})}):t.jsxs("div",{className:"text-center py-12 content-card",children:[t.jsx($,{size:52,className:"mx-auto text-[var(--text-muted)] mb-4 opacity-50"}),t.jsx("p",{className:"text-[var(--text-secondary)] text-lg",children:"No report data for this period."}),t.jsx("p",{className:"text-[var(--text-muted)] text-sm mt-1",children:'Download a processed list from the "Tithe Processor" view to populate reports.'})]})]})};export{et as default};
