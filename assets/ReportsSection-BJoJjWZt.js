import{c as Y,j as t,m as N,A as I,v as b,u as H,r as j,L as V,P as D,S as W,b as C,d as L,e as G,g as T,o as B,U}from"./index-C0VftjXC.js";import{S as $,A as P,D as z,T as M}from"./AnimatedNumber-Bm4Wpt3x.js";import{L as _,D as J}from"./LiquidButton-DsGc4D_9.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=Y("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),S=N.path,O=N.circle,q=({performanceData:i,granularity:u})=>{const o={top:20,right:30,bottom:40,left:60},d=800-o.left-o.right,e=300-o.top-o.bottom,n=Math.max(...i.map(s=>s.totalTithe),0),c=Math.max(...i.map(s=>s.soulsWon),0),r=(()=>{switch(u){case"yearly":case"monthly":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];case"weekly":return i.map(s=>`W${s.key}`);case"daily":return i.map(s=>s.key);default:return[]}})(),p=(s,l)=>{if(l===0)return`M 0 ${e}`;let x=`M 0 ${e-i[0][s]/l*e}`;return i.forEach((v,k)=>{if(k>0){const F=k/(i.length-1)*d,R=e-v[s]/l*e;x+=` L ${F} ${R}`}}),x},f=(s,l)=>`${p(s,l)} L ${d} ${e} L 0 ${e} Z`,y=5,g=Array.from({length:y+1},(s,l)=>Math.ceil(n/y)*l),A=Math.min(5,c+1),w=c>0?Array.from({length:A+1},(s,l)=>Math.round(c/A*l)):[0];return t.jsxs("div",{className:"w-full overflow-x-auto",children:[t.jsxs("svg",{width:"100%",viewBox:"0 0 800 300","aria-label":"District performance trend chart",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"titheAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--primary-accent-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--primary-accent-start)",stopOpacity:"0"})]}),t.jsxs("linearGradient",{id:"soulsAreaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:"var(--success-start)",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"var(--success-start)",stopOpacity:"0"})]})]}),t.jsxs("g",{transform:`translate(${o.left}, ${o.top})`,children:[g.map((s,l)=>t.jsx("line",{x1:"0",y1:n>0?e-s/n*e:e,x2:d,y2:n>0?e-s/n*e:e,className:"stroke-current text-[var(--border-color)]",strokeDasharray:"3,3"},`grid-${s}-${l}`)),t.jsx(S,{d:f("totalTithe",n),fill:"url(#titheAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2}}),t.jsx(S,{d:p("totalTithe",n),fill:"none",stroke:"var(--primary-accent-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut"}}),t.jsx(S,{d:f("soulsWon",c),fill:"url(#soulsAreaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4}}),t.jsx(S,{d:p("soulsWon",c),fill:"none",stroke:"var(--success-start)",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut",delay:.2}}),i.map((s,l)=>t.jsxs("g",{transform:`translate(${l/(i.length-1)*d}, 0)`,children:[s.totalTithe>0&&t.jsx("g",{tabIndex:0,role:"button","aria-label":`Tithe for ${r[l]}: GH₵ ${s.totalTithe.toLocaleString()}`,className:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary-accent-start)] rounded-full",children:t.jsx(O,{cy:n>0?e-s.totalTithe/n*e:e,r:"4",fill:"var(--primary-accent-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.5+l*.05},children:t.jsxs("title",{children:["GH₵ ",s.totalTithe.toLocaleString()]})})}),s.soulsWon>0&&t.jsx("g",{tabIndex:0,role:"button","aria-label":`${s.soulsWon} souls won in ${r[l]}`,className:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--success-start)] rounded-full",children:t.jsx(O,{cy:c>0?e-s.soulsWon/c*e:e,r:"4",fill:"var(--success-start)",initial:{scale:0},animate:{scale:1},transition:{duration:.3,delay:1.7+l*.05},children:t.jsxs("title",{children:[s.soulsWon," Souls Won"]})})})]},`point-group-${l}`)),t.jsx("line",{x1:"0",y1:"0",x2:"0",y2:e,className:"stroke-current text-[var(--border-color-light)]"}),g.map((s,l)=>t.jsx("text",{x:"-10",y:n>0?e-s/n*e+4:e+4,textAnchor:"end",className:"fill-current text-[var(--text-secondary)] text-xs",children:s>=1e3?`${(s/1e3).toFixed(1)}k`:s},`y-tick-tithe-${s}-${l}`)),t.jsx("text",{transform:`translate(-40, ${e/2}) rotate(-90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Total Tithe (GH₵)"}),t.jsx("line",{x1:d,y1:"0",x2:d,y2:e,className:"stroke-current text-[var(--border-color-light)]"}),w.map(s=>t.jsx("text",{x:d+10,y:c>0?e-s/c*e+4:e+4,textAnchor:"start",className:"fill-current text-[var(--text-secondary)] text-xs",children:s},`y-tick-souls-${s}`)),t.jsx("text",{transform:`translate(${d+o.right-15}, ${e/2}) rotate(90)`,textAnchor:"middle",className:"fill-current text-[var(--text-primary)] text-sm",children:"Souls Won"}),t.jsx("line",{x1:"0",y1:e,x2:d,y2:e,className:"stroke-current text-[var(--border-color-light)]"}),r.map((s,l)=>t.jsx("text",{x:l/(r.length-1)*d,y:e+20,textAnchor:"middle",className:"fill-current text-[var(--text-secondary)] text-xs",children:s},`x-tick-${l}`))]})]}),t.jsxs("div",{className:"flex justify-center items-center gap-6 mt-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--primary-accent-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Total Tithe"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-[var(--success-start)]"}),t.jsx("span",{className:"text-[var(--text-secondary)]",children:"Souls Won"})]})]})]})},E=i=>{const u=new Date(i.valueOf()),a=(i.getDay()+6)%7;u.setDate(u.getDate()-a+3);const m=u.valueOf();return u.setMonth(0,1),u.getDay()!==4&&u.setMonth(0,1+(4-u.getDay()+7)%7),1+Math.ceil((m-u.valueOf())/6048e5)},Z=(i,u)=>{const a={},m=()=>I.map(o=>({assemblyName:o,totalTithe:0,soulsWon:0,titherCount:0,recordCount:0}));return i.forEach(o=>{const d=new Date(o.selectedDate),e=d.getFullYear(),n=d.getMonth(),c=E(d),h=d.getDate();a[e]||(a[e]={months:{},weeks:{},days:{}}),a[e].months[n]||(a[e].months[n]=m()),a[e].weeks[c]||(a[e].weeks[c]=m()),a[e].days[n]||(a[e].days[n]={}),a[e].days[n][h]||(a[e].days[n][h]=m());const r=a[e].months[n].find(y=>y.assemblyName===o.assemblyName),p=a[e].weeks[c].find(y=>y.assemblyName===o.assemblyName),f=a[e].days[n][h].find(y=>y.assemblyName===o.assemblyName);r&&(r.totalTithe+=o.totalTitheAmount,r.titherCount+=o.titherCount,r.recordCount+=o.recordCount),p&&(p.totalTithe+=o.totalTitheAmount,p.titherCount+=o.titherCount,p.recordCount+=o.recordCount),f&&(f.totalTithe+=o.totalTitheAmount,f.titherCount+=o.titherCount,f.recordCount+=o.recordCount)}),Object.keys(u).forEach(o=>{var e;(((e=u[o])==null?void 0:e.data)||[]).forEach(n=>{if(n.firstSeenDate)try{const c=new Date(n.firstSeenDate),h=c.getFullYear(),r=c.getMonth(),p=E(c),f=c.getDate();if(a[h]){if(a[h].months[r]){const y=a[h].months[r].find(g=>g.assemblyName===o);y&&(y.soulsWon+=1)}if(a[h].weeks[p]){const y=a[h].weeks[p].find(g=>g.assemblyName===o);y&&(y.soulsWon+=1)}if(a[h].days[r]&&a[h].days[r][f]){const y=a[h].days[r][f].find(g=>g.assemblyName===o);y&&(y.soulsWon+=1)}}}catch{}})}),a},Q=(i,u)=>{const a={totalTithe:0,totalSouls:0,topPerformingAssembly:{name:"N/A",value:0},topGrowthAssembly:{name:"N/A",value:0},performance:[]},m=new Map;u==="days"?Object.keys(i).forEach(e=>{Object.keys(i[e]).forEach(n=>{let c=0,h=0;i[e][n].forEach(r=>{c+=r.totalTithe,h+=r.soulsWon;const p=m.get(r.assemblyName)||{totalTithe:0,soulsWon:0};m.set(r.assemblyName,{totalTithe:p.totalTithe+r.totalTithe,soulsWon:p.soulsWon+r.soulsWon})}),a.totalTithe+=c,a.totalSouls+=h,a.performance.push({key:`${e}/${n}`,totalTithe:c,soulsWon:h})})}):Object.keys(i).forEach(e=>{let n=0,c=0;i[e].forEach(h=>{n+=h.totalTithe,c+=h.soulsWon;const r=m.get(h.assemblyName)||{totalTithe:0,soulsWon:0};m.set(h.assemblyName,{totalTithe:r.totalTithe+h.totalTithe,soulsWon:r.soulsWon+h.soulsWon})}),a.totalTithe+=n,a.totalSouls+=c,a.performance.push({key:e,totalTithe:n,soulsWon:c})});const o=[...m.entries()].sort((e,n)=>n[1].totalTithe-e[1].totalTithe);o.length>0&&o[0][1].totalTithe>0&&(a.topPerformingAssembly={name:o[0][0],value:o[0][1].totalTithe});const d=[...m.entries()].sort((e,n)=>n[1].soulsWon-e[1].soulsWon);return d.length>0&&d[0][1].soulsWon>0&&(a.topGrowthAssembly={name:d[0][0],value:d[0][1].soulsWon}),a},K=(i,u,a)=>{let m="data:text/csv;charset=utf-8,";return m+=`Summary for ${u}
`,m+=`Total Tithe,Total Souls Won
`,m+=`${b(i.totalTithe)},${b(i.totalSouls)}

`,m+=`Top Performing Assembly (Tithe),${b(i.topPerformingAssembly.name)},${b(i.topPerformingAssembly.value)}
`,m+=`Top Performing Assembly (Growth),${b(i.topGrowthAssembly.name)},${b(i.topGrowthAssembly.value)}

`,m+=`Performance Data (${a})
`,m+=`Period,Total Tithe,Souls Won
`,i.performance.forEach(o=>{m+=`${b(o.key)},${b(o.totalTithe)},${b(o.soulsWon)}
`}),m},tt=i=>{switch(i){case"yearly":case"monthly":return"months";case"weekly":return"weeks";case"daily":return"days"}},ot=()=>{const{transactionLog:i=[],memberDatabase:u={}}=H(),[a,m]=j.useState(new Date().getFullYear()),[o,d]=j.useState("monthly"),[e,n]=j.useState(!0),[c,h]=j.useState({}),[r,p]=j.useState(null),f=j.useMemo(()=>{const s=new Set(Object.keys(c).map(Number)),l=new Date().getFullYear();return s.add(l),Array.from(s).sort((x,v)=>v-x)},[c]);j.useEffect(()=>{n(!0);const s=Z(i,u);h(s);const l=s[a];if(!l){p({totalTithe:0,totalSouls:0,topPerformingAssembly:{name:"N/A",value:0},topGrowthAssembly:{name:"N/A",value:0},performance:[]}),n(!1);return}let x;switch(o){case"yearly":x=l.months;break;case"monthly":x=l.months;break;case"weekly":x=l.weeks;break;case"daily":x=l.days;break;default:x=l.months}const v=Q(x,tt(o));p(v),n(!1)},[i,u,a,o]);const y=()=>{if(!r)return;const s=K(r,a,o),l=encodeURI(s),x=document.createElement("a");x.setAttribute("href",l),x.setAttribute("download",`report_${a}_${o}.csv`),document.body.appendChild(x),x.click(),document.body.removeChild(x)},g=r&&(r.totalTithe>0||r.totalSouls>0),A={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.07}}},w={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return e?t.jsx(V,{text:"Processing report data..."}):t.jsxs("div",{className:"space-y-8",children:[t.jsx("section",{className:"content-card","aria-labelledby":"reports-heading",children:t.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[t.jsxs("h2",{id:"reports-heading",className:"section-heading border-none pb-0 mb-0",children:[t.jsx(D,{size:22,className:"mr-3 icon-primary"}),"Annual Performance Dashboard"]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(W,{value:String(a),onValueChange:s=>m(Number(s)),children:[t.jsx(C,{className:"w-[100px]",children:t.jsx(L,{placeholder:"Year"})}),t.jsx(G,{className:"glassmorphism-bg border border-[var(--border-color)] rounded-xl",children:f.map(s=>t.jsx(T,{value:String(s),children:s},s))})]}),t.jsxs(W,{value:o,onValueChange:s=>d(s),children:[t.jsx(C,{className:"w-[120px]",children:t.jsx(L,{placeholder:"Granularity"})}),t.jsxs(G,{className:"glassmorphism-bg border border-[var(--border-color)] rounded-xl",children:[t.jsx(T,{value:"yearly",children:"Yearly"}),t.jsx(T,{value:"monthly",children:"Monthly"}),t.jsx(T,{value:"weekly",children:"Weekly"}),t.jsx(T,{value:"daily",children:"Daily"})]})]}),t.jsxs(_,{onClick:y,children:[t.jsx(J,{size:16,className:"mr-2"}),"Download CSV"]})]})]})}),g&&r?t.jsx(B,{children:t.jsxs(N.div,{className:"space-y-8",initial:"hidden",animate:"visible",variants:A,children:[t.jsxs(N.section,{variants:w,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx($,{icon:t.jsx(z,{}),label:`District Total Tithe (${a})`,value:t.jsxs(t.Fragment,{children:["GH₵"," ",t.jsx(P,{n:r.totalTithe,formatter:s=>s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),ariaLabel:`District Total Tithe for ${a}: GH₵ ${r.totalTithe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsx($,{icon:t.jsx(U,{}),label:`District Souls Won (${a})`,value:t.jsx(P,{n:r.totalSouls}),ariaLabel:`District Souls Won for ${a}: ${r.totalSouls}`}),t.jsx($,{icon:t.jsx(M,{}),label:"Top Assembly (Tithe)",value:r.topPerformingAssembly.name,subValue:`GH₵ ${r.topPerformingAssembly.value.toLocaleString()}`,valueClassName:"text-gradient-primary",ariaLabel:`Top Assembly by Tithe: ${r.topPerformingAssembly.name} with GH₵ ${r.topPerformingAssembly.value.toLocaleString()}`}),t.jsx($,{icon:t.jsx(M,{}),label:"Top Assembly (Growth)",value:r.topGrowthAssembly.name,subValue:`${r.topGrowthAssembly.value} souls`,valueClassName:"text-gradient-primary",ariaLabel:`Top Assembly by Growth: ${r.topGrowthAssembly.name} with ${r.topGrowthAssembly.value} souls`})]}),t.jsxs(N.section,{variants:w,className:"content-card",children:[t.jsxs("h3",{className:"section-heading",children:[t.jsx(X,{size:20,className:"mr-3 icon-primary"}),"District Performance Over Time (",a,")"]}),t.jsx(q,{performanceData:r.performance,granularity:o})]})]})}):t.jsxs("div",{className:"text-center py-12 content-card",children:[t.jsx(D,{size:52,className:"mx-auto text-[var(--text-muted)] mb-4 opacity-50"}),t.jsx("p",{className:"text-[var(--text-secondary)] text-lg",children:"No report data for this period."}),t.jsx("p",{className:"text-[var(--text-muted)] text-sm mt-1",children:'Download a processed list from the "Tithe Processor" view to populate reports.'})]})]})};export{ot as default};
