import{c as p,j as e,m as b,r as x,b as S,B as f,d as I,e as $,C as L,u as _,g as G,h as z,i as A,U as C}from"./index-BQ4ypfwp.js";import{c as T}from"./index-DHRzfDKV.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=p("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=p("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=p("MessageSquareQuote",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M8 12a2 2 0 0 0 2-2V8H8",key:"1jfesj"}],["path",{d:"M14 12a2 2 0 0 0 2-2V8h-2",key:"1dq9mh"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=p("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=p("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),B=()=>e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--bg-elevated)] animate-pulse flex-shrink-0"}),e.jsx("div",{className:"w-3/5",children:e.jsx("div",{className:"h-20 w-full rounded-lg bg-[var(--bg-elevated)] animate-pulse"})})]}),e.jsxs("div",{className:"flex items-end gap-3 flex-row-reverse",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--bg-elevated)] animate-pulse flex-shrink-0"}),e.jsx("div",{className:"w-1/2",children:e.jsx("div",{className:"h-12 w-full rounded-lg bg-[var(--bg-elevated)] animate-pulse"})})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--bg-elevated)] animate-pulse flex-shrink-0"}),e.jsx("div",{className:"w-4/5",children:e.jsx("div",{className:"h-28 w-full rounded-lg bg-[var(--bg-elevated)] animate-pulse"})})]})]}),O=b.rect,R=b.text,U=({data:n,chartHeight:a=220,barWidth:i=35,barMargin:m=20})=>{const l=n.length*(i+m),o=Math.max(...n.map(t=>t.count),0);return e.jsx("div",{className:"bar-chart-container w-full overflow-x-auto pb-4",children:e.jsxs("svg",{width:l,height:a,"aria-label":"Contribution Distribution Chart",children:[e.jsx("g",{transform:"translate(0, 10)",children:n.map((t,c)=>{const r=o>0?t.count/o*(a-40):0;return e.jsxs("g",{transform:`translate(${c*(i+m)}, 0)`,children:[e.jsx("title",{children:`${t.label}: ${t.count} members`}),e.jsx(O,{className:"bar",x:0,y:a-30-r,width:i,height:r,fill:"url(#barGradient)",rx:"4",ry:"4",initial:{height:0,y:a-30},animate:{height:r,y:a-30-r},transition:{duration:.8,ease:[.22,1,.36,1],delay:c*.1}}),e.jsx(R,{className:"bar-value",x:i/2,y:a-35-r,textAnchor:"middle",initial:{opacity:0,y:a-30},animate:{opacity:1,y:a-35-r},transition:{duration:.8,ease:"easeOut",delay:c*.1+.3},children:t.count}),e.jsx("text",{className:"axis-text",x:i/2,y:a-15,textAnchor:"middle",children:t.label})]},t.label)})}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--primary-accent-hover-start)"}),e.jsx("stop",{offset:"100%",stopColor:"var(--primary-accent-start)"})]})})]})})},F=({chatHistory:n,isLoading:a,onSendMessage:i,suggestedPrompts:m})=>{const[l,o]=x.useState(""),t=x.useRef(null);x.useEffect(()=>{var s;(s=t.current)==null||s.scrollIntoView({behavior:"smooth"})},[n]);const c=s=>{s==null||s.preventDefault(),l.trim()&&!a&&(i(l.trim()),o(""))},r=s=>{i(s)};return e.jsxs("div",{className:"flex flex-col h-[60vh] md:h-[calc(100vh-250px)]",children:[e.jsxs("div",{className:"flex-grow overflow-y-auto pr-4 space-y-6",children:[n.map((s,d)=>e.jsx("div",{className:`chat-message ${s.role}`,children:e.jsx("div",{className:`chat-bubble ${s.role}`,children:s.isLoading&&s.parts[0].text===""?e.jsxs("div",{className:"typing-indicator px-2 py-1",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}):e.jsx("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:S(s.parts[0].text||"")}})})},d)),e.jsx("div",{ref:t})]}),e.jsxs("div",{className:"pt-4 mt-auto",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:m.map(s=>e.jsxs(f,{size:"sm",variant:"subtle",onClick:()=>r(s),disabled:a,children:[e.jsx(P,{size:14,className:"mr-1.5 text-[var(--primary-accent-end)]"})," ",s]},s))}),e.jsxs("form",{onSubmit:c,className:"flex items-center gap-3",children:[e.jsx("textarea",{value:l,onChange:s=>o(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&c(s)},placeholder:"Ask a follow-up question...",className:"form-input-light flex-grow !rounded-xl resize-none",rows:1,style:{maxHeight:"150px"},disabled:a}),e.jsx(f,{type:"submit",size:"icon",variant:"primary",disabled:a||!l.trim(),children:e.jsx(V,{size:18})})]})]})]})},K=T("inline-flex items-center justify-center cursor-pointer rounded-md transition-colors disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary-accent-start text-white shadow-xs hover:bg-primary-accent-end",muted:"bg-muted text-muted-foreground",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50"},size:{default:"size-8 rounded-lg [&_svg]:size-4",sm:"size-6 [&_svg]:size-3",md:"size-10 rounded-lg [&_svg]:size-5",lg:"size-12 rounded-xl [&_svg]:size-6"}},defaultVariants:{variant:"default",size:"default"}});function Q({content:n,className:a,size:i,variant:m,delay:l=3e3,onClick:o,onCopy:t,isCopied:c,onCopyChange:r,...s}){const[d,h]=x.useState(c??!1),j=d?L:q;x.useEffect(()=>{h(c??!1)},[c]);const g=x.useCallback(u=>{h(u),r==null||r(u)},[r]),y=x.useCallback(u=>{c||(n&&navigator.clipboard.writeText(n).then(()=>{g(!0),setTimeout(()=>g(!1),l),t==null||t(n)}).catch(v=>{console.error("Error copying command",v)}),o==null||o(u))},[c,n,l,o,t,g]);return e.jsx(b.button,{"data-slot":"copy-button",whileHover:{scale:1.05},whileTap:{scale:.95},className:I(K({variant:m,size:i}),a),onClick:y,...s,children:e.jsx($,{mode:"wait",children:e.jsx(b.span,{"data-slot":"copy-button-icon",initial:{scale:0},animate:{scale:1},exit:{scale:0},transition:{duration:.15},children:e.jsx(j,{})},d?"check":"copy")})})}const W=({summary:n})=>{const a=n.replace(/\n/g,"<br />").replace(/\* \*\*(.*?)\*\*/g,'<li><strong class="text-[var(--primary-accent-start)]">$1</strong>').replace(/<\/strong>:(.*?)<br \/>/g,"</strong>:$1</li>").replace(/- \*\*(.*?)\*\*/g,'<li><strong class="text-[var(--primary-accent-start)]">$1</strong>').replace(/\*\*(.*?)\*\*/g,'<strong class="text-[var(--primary-accent-start)]">$1</strong>').replace(/- (.*?)(<br \/>|$)/g,'<li class="list-none ml-0 mb-1.5">$1</li>');return e.jsxs("div",{className:"content-card bg-[var(--bg-elevated)] border-l-4 border-[var(--primary-accent-start)]",children:[e.jsxs("h3",{className:"section-heading text-base !mb-3",children:[e.jsx(D,{size:18,className:"mr-3 icon-primary"}),"AI-Generated Summary"]}),e.jsx("ul",{className:"text-sm space-y-2 text-[var(--text-secondary)]",dangerouslySetInnerHTML:{__html:a}})]})},H=()=>e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((n,a)=>e.jsxs("div",{className:"p-4 bg-[var(--bg-card-subtle-accent)] rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-[var(--border-color)] rounded w-1/3 mb-3"}),e.jsx("div",{className:"h-3 bg-[var(--border-color)] rounded w-full mb-1"}),e.jsx("div",{className:"h-3 bg-[var(--border-color)] rounded w-5/6"})]},a))}),Y=({reconciliationReport:n,addToast:a})=>{const[i,m]=x.useState([]),[l,o]=x.useState(!1),[t,c]=x.useState(null),r=(n==null?void 0:n.newMembers)||[],s=async()=>{if(r.length===0){a("No new members found in the current data to generate messages for.","warning");return}{a("AI features are not configured. Please contact support.","error");return}};return e.jsxs("section",{className:"content-card",children:[e.jsxs("h2",{className:"section-heading",children:[e.jsx(E,{size:22,className:"mr-3 icon-primary"}),"AI Outreach Assistant"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"outreach-target",className:"form-label",children:"Select Target Group"}),e.jsx("select",{id:"outreach-target",className:"form-input-light w-full",children:e.jsxs("option",{children:["New Members (Souls Won) (",r.length,")"]})})]}),e.jsx("div",{className:"self-end",children:e.jsx(f,{onClick:s,isLoading:l,disabled:r.length===0||l,variant:"secondary",fullWidth:!0,children:"Generate Welcome Messages"})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-[var(--border-color)]",children:[l&&e.jsx(H,{}),t&&e.jsxs("div",{className:"text-center py-6 text-[var(--danger-text)]",children:[e.jsx(A,{size:32,className:"mx-auto mb-2"}),e.jsx("p",{children:t})]}),!l&&!t&&i.length>0&&e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:i.map((d,h)=>e.jsxs("div",{className:"p-4 bg-[var(--bg-elevated)] rounded-lg border border-[var(--border-color)]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"font-semibold text-[var(--text-primary)] flex items-center gap-2",children:[e.jsx(C,{size:16})," ",d.memberName]}),e.jsx(Q,{content:d.message})]}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] whitespace-pre-wrap",children:d.message})]},h))}),!l&&!t&&i.length===0&&e.jsx("div",{className:"text-center py-6 text-[var(--text-muted)]",children:r.length>0?"Click 'Generate' to create personalized welcome messages for your new members.":"No new members found in the current workspace. Upload and reconcile a new file to identify them."})]})]})},X=()=>{var w;const{titheListData:n=[],currentAssembly:a,selectedDate:i,addToast:m,tithersCount:l,nonTithersCount:o,totalAmount:t,reconciliationReport:c}=_(),{chatHistory:r,chartData:s,isLoading:d,error:h,sendMessage:j}=G(),g=()=>{{m("AI feature is not configured.","error");return}},y=k=>{k.trim()&&j(k)},u=n.length>0,v=r.length>0,N=(w=r[0])==null?void 0:w.summary,M=["What are the key observations from this data?","Suggest some potential actions based on these numbers.","What if participation increased by 10%?",`How does ${a||"this assembly"} compare to typical patterns?`];return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Y,{reconciliationReport:c,addToast:m}),e.jsx("section",{className:"content-card",children:e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsxs("h2",{id:"analytics-heading",className:"section-heading border-none pb-0 mb-0",children:[e.jsx(z,{size:22,className:"mr-3 icon-primary"}),"AI-Powered Analytics Chat"]}),e.jsx(f,{onClick:g,disabled:!u||d,isLoading:d&&!v,variant:"primary",children:v?`Restart Analysis for ${a}`:"Analyze with AI"})]})}),e.jsxs("div",{className:"min-h-[400px]",children:[h&&e.jsxs("div",{className:"content-card text-center py-10 flex flex-col items-center",children:[e.jsx(A,{size:48,className:"text-[var(--danger-text)] mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-[var(--danger-text)]",children:"Analysis Failed"}),e.jsx("p",{className:"text-[var(--text-secondary)] mt-2 max-w-md",children:h})]}),!v&&!d&&!h&&e.jsxs("div",{className:"content-card text-center py-10 flex flex-col items-center animate-fadeIn",children:[e.jsx(z,{size:52,className:"mx-auto text-[var(--text-muted)] mb-4 opacity-50"}),e.jsx("h3",{className:"text-xl font-semibold text-[var(--text-primary)]",children:"Ready for Insights?"}),e.jsx("p",{className:"text-[var(--text-secondary)] mt-2 max-w-md",children:u?`You have a list for ${a} Assembly ready. Click "Analyze with AI" to start a conversation about your data.`:"Generate or load a tithe list in the Processor view, then come back here to get an AI-powered analysis."})]}),d&&!v&&e.jsx("div",{className:"content-card",children:e.jsx(B,{})}),v&&!h&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[N&&e.jsx(W,{summary:N}),e.jsx("div",{className:"content-card",children:e.jsx(F,{chatHistory:r,isLoading:d,onSendMessage:y,suggestedPrompts:M})})]}),e.jsx("div",{className:"lg:col-span-1 space-y-8 sticky top-8",children:s.length>0&&e.jsxs("div",{className:"content-card animate-fadeIn",children:[e.jsx("h3",{className:"section-heading text-base !mb-6",children:"Contribution Distribution"}),e.jsx(U,{data:s})]})})]})]})]})};export{X as default};
